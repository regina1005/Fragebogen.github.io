import{r as Jr,g as Zr}from"./vendor-Czn-76cG.js";import{g as eo,a as to,e as dn,b as no,c as io,d as ys,m as ie,s as yi,f as so,h as Ci,i as Mn,j as ro,S as oo}from"./swiper-5vHbYaTT.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();class ao{constructor(e){this.pages=e,this.currentIndex=0,this.isAnimating=!1,this.btnBack=document.getElementById("btn-back"),this.btnNext=document.getElementById("btn-next"),this.btnStart=document.getElementById("btn-start"),this.dotsContainer=document.getElementById("dots"),this.bottomBar=document.getElementById("bottom-bar"),this._initDots(),this._bindEvents(),this._update()}_initDots(){this.dotsContainer.innerHTML="";for(let e=1;e<this.pages.length;e++){const n=document.createElement("span");n.className="dot",this.dotsContainer.appendChild(n)}}_bindEvents(){this.btnBack.addEventListener("click",()=>this.back()),this.btnNext.addEventListener("click",()=>this.next()),this.btnStart&&this.btnStart.addEventListener("click",n=>{n.stopPropagation(),this.next()});const e=document.getElementById(`page-${this.pages[0]}`);e&&e.addEventListener("click",()=>this.next())}next(){this.isAnimating||this.currentIndex>=this.pages.length-1||this._animateTo(this.currentIndex+1,"forward")}back(){this.isAnimating||this.currentIndex<=0||this._animateTo(this.currentIndex-1,"backward")}_animateTo(e,n){this.isAnimating=!0;const i=document.getElementById(`page-${this.pages[this.currentIndex]}`),s=document.getElementById(`page-${this.pages[e]}`),r=300,a=window.matchMedia("(prefers-reduced-motion: reduce)").matches?10:r;s.style.transition="none",s.style.transform=n==="forward"?"translateX(100%)":"translateX(-100%)",s.classList.add("page-active"),s.offsetHeight;const l=`transform ${r}ms cubic-bezier(0.4, 0, 0.2, 1)`;i.style.transition=l,i.style.transform=n==="forward"?"translateX(-100%)":"translateX(100%)",s.style.transition=l,s.style.transform="translateX(0)",this.currentIndex=e,this._update(),setTimeout(()=>{i.classList.remove("page-active"),i.style.transition="",i.style.transform="",s.style.transition="",s.style.transform="",this.isAnimating=!1},a)}_update(){const e=this.currentIndex===0,n=this.currentIndex===this.pages.length-1;this.bottomBar.classList.toggle("hidden",e),this.btnBack.setAttribute("aria-hidden",String(e)),this.btnNext.setAttribute("aria-hidden",String(n)),this.dotsContainer.querySelectorAll(".dot").forEach((s,r)=>{s.classList.toggle("dot-active",r+1===this.currentIndex)})}}var lo=Jr();const co=Zr(lo);async function ho(t="./data.csv"){try{const e=await fetch(t);if(!e.ok)throw new Error(`Fehler beim Laden der CSV-Datei: HTTP ${e.status}`);const n=await e.text();return new Promise((i,s)=>{co.parse(n,{header:!0,skipEmptyLines:!0,dynamicTyping:!0,delimiter:";",complete:r=>{const o=un(r.data);i(o)},error:r=>{s(r)}})})}catch(e){throw console.error("Error loading CSV:",e),e}}function un(t){return{teilA:bi(t,["frage_a1","frage_a2","frage_a3","frage_a4","frage_a5","frage_a6","frage_a7"],{min:1,max:5}),teilB:jt(t,["frage_b1","frage_b2","frage_b3","frage_b4","frage_b5","frage_b6","frage_b7","frage_b8","frage_b9"]),teilC:jt(t,["frage_c1","frage_c2","frage_c4","frage_c5","frage_c6","frage_c7"]),faltstrategieTexte:t.map(e=>({text:String(e.frage_c3||"").replace(/^[„""]|["""]$/g,"").trim(),zugehoerigkeit:e.zugehoerigkeit,name:e.name,alter:e.alter,faltStrategie:e.frage_c2})).filter(e=>e.text),abschiebsbriefe:t.map(e=>({text:e.abschiedsbrief,zugehoerigkeit:e.zugehoerigkeit,name:e.name,alter:e.alter})).filter(e=>e.text),zeichnungen:t.map(e=>({datei:e.zeichnung_datei,name:e.name,alter:e.alter})).filter(e=>e.datei),teilD3:t.map(e=>({value:e.frage_d3,zugehoerigkeit:e.zugehoerigkeit})).filter(e=>e.value!==null&&e.value!==void 0&&e.value!==""),teilE:{singleChoice:jt(t,["frage_e1","frage_e2","frage_e3"]),likert3:bi(t,["frage_e4_1","frage_e4_2","frage_e4_3"],{min:0,max:2})},teilnehmerAnzahl:t.length,rawRows:t}}function uo(t,e){if(!t)return un([]);const n=e==="alle"?t:t.filter(i=>(i.zugehoerigkeit||"").toLowerCase()===e.toLowerCase());return un(n)}function bi(t,e,{min:n=1,max:i=5}={}){return e.map(s=>{const r=t.map(h=>h[s]).filter(h=>h!=null&&h!==""&&Number.isFinite(Number(h))&&Number(h)>=n&&Number(h)<=i);if(r.length===0)return{median:null,mean:null};const o=r.map(Number),a=o.reduce((h,d)=>h+d,0)/o.length,l=[...o].sort((h,d)=>h-d),c=Math.floor(l.length/2),u=l.length%2===0?(l[c-1]+l[c])/2:l[c];return{median:Number(u.toFixed(2)),mean:Number(a.toFixed(2))}})}function jt(t,e){return e.map(n=>{const i={};let s=0;return t.forEach(r=>{const o=r[n];o!=null&&o!==""&&(i[o]=(i[o]||0)+1,s++)}),Object.entries(i).map(([r,o])=>({option:String(r),count:o,percentage:Number((o/s*100).toFixed(1))})).sort((r,o)=>o.count-r.count)})}const fo=["Ich empfinde eine tiefe Loyalität gegenüber zusammengehörigen Socken.","Der Verlust einer Socke beeinflusst meine emotionale Grundstimmung messbar.","Ich habe schon einmal aktiv nach einer einzelnen Socke gesucht, obwohl die Wahrscheinlichkeit gering war.","Gemusterte Socken vermitteln mir mehr Identitätsstabilität als einfarbige.","Ich glaube, dass Socken im Wäschekorb soziale Bindungen eingehen.","Zwei unterschiedliche Socken zu tragen fühlt sich rebellisch-autonom an.","Das Wegwerfen einer Einzelsocke ist ein Akt innerer Reife."],po=["Durch die Bearbeitung dieses Fragebogens hat sich meine Perspektive auf meine Beziehung zu Socken verändert.","Ich nehme aktuell eine erhöhte Bewusstheit hinsichtlich textiler Mikroentscheidungen wahr.","Ich gehe davon aus, dass die Auseinandersetzung mit textiler Bindungsdynamik mein zukünftiges Sockenauswahlverhalten beeinflussen wird."],_o=["nie","selten","manchmal","oft","immer"];function Ei(t,e,n){return t==null?"50%":`${(t-e)/(n-e)*100}%`}function go(t,e,n,i,s){const{scaleMin:r,scaleMax:o,scaleLabels:a,prefix:l}=s,c=document.createElement("div");c.className="visualization-card",c.setAttribute("aria-label",`Frage ${l}${i+1}: ${t}`);const u=e!==null&&n!==null,h=u?Number(e).toFixed(1):"–",d=u?Number(n).toFixed(1):"–",_=u&&Math.abs(e-n)<.4,m=_?"top: 28px;":"",y=_?"position: absolute; top: 14px; transform: none;":"",T=Ei(e,r,o),f=Ei(n,r,o),p=u?`
    <div class="likert-marker median" style="left: ${T}">
      <span class="likert-marker-label" aria-hidden="true">${h}</span>
      <div class="likert-marker-dot" title="Median: ${h}"></div>
    </div>
    <div class="likert-marker mean" style="left: ${f}; ${m}">
      <span class="likert-marker-label" style="${y}" aria-hidden="true">${d}</span>
      <div class="likert-marker-dot" title="Durchschnitt: ${d}"></div>
    </div>
  `:'<div class="likert-no-data">Daten werden noch erhoben</div>';return c.innerHTML=`
    <div class="visualization-card-index">${l}${i+1}</div>
    <div class="visualization-title">${t}</div>
    <div class="likert-scale" role="img" aria-label="Likert-Skala: Median ${h}, Durchschnitt ${d}">
      <div class="likert-track">
        <div class="likert-ticks">
          ${a.map(()=>'<div class="likert-tick"></div>').join("")}
        </div>
        <div class="likert-markers">
          ${p}
        </div>
      </div>
      <div class="likert-labels" aria-hidden="true">
        ${a.map(v=>`<span>${v}</span>`).join("")}
      </div>
    </div>
    <div class="likert-legend" aria-hidden="true">
      <div class="likert-legend-item">
        <div class="likert-legend-dot median"></div>
        <span>Median: ${h}</span>
      </div>
      <div class="likert-legend-item">
        <div class="likert-legend-dot mean"></div>
        <span>Durchschnitt: ${d}</span>
      </div>
    </div>
  `,c}function mo(t){const e=new IntersectionObserver(n=>{n.forEach(i=>{i.isIntersecting&&(i.target.classList.add("visible"),e.unobserve(i.target))})},{threshold:.12,rootMargin:"0px 0px -40px 0px"});t.forEach(n=>e.observe(n))}function ke(t,e,n={}){const{questions:i=fo,scaleMin:s=1,scaleMax:r=5,scaleLabels:o=_o,prefix:a="A"}=n,l=document.getElementById(t);if(!l)return;l.innerHTML="";const c=Array.isArray(e)&&e.length>0;i.forEach((h,d)=>{const _=c&&e[d]?e[d]:{median:null,mean:null},m=go(h,_.median,_.mean,d,{scaleMin:s,scaleMax:r,scaleLabels:o,prefix:a});l.appendChild(m)});const u=l.querySelectorAll(".visualization-card");mo(u)}const Kt=[{title:"In einem Szenario textiler Destabilisierung bevorzuge ich:",options:["Erhalt beider, jedoch perforierter Socken","Vollständige Eliminierung einer einzelnen Socke"]},{title:"Ich priorisiere bei textiler Auswahl:",options:["Maximale visuelle Kongruenz","Maximale individualistische Divergenz"]},{title:"Im Kontext langfristiger Nutzung bewerte ich als bedeutsamer:",options:["Strukturelle Haltbarkeit","Ästhetische Musterkomplexität"]},{title:"Bei drohendem Sockenschwund neige ich eher zu:",options:["Aktiver Suchinitiative","Akzeptanzbasierter Verlustverarbeitung"]},{title:"In Bezug auf textile Paarbildung empfinde ich als zentraler:",options:["Symmetrische Gleichwertigkeit","Funktionale Ergänzung"]},{title:"Bei geringfügiger Asymmetrie reagiere ich überwiegend mit:",options:["Kognitiver Dissonanz","Flexibler Integrationsbereitschaft"]},{title:"Im Falle chronischer Einzelsocken-Situation tendiere ich zu:",options:["Persistierender Hoffnung","Adaptiver Neubildung"]},{title:"Innerhalb der Sockenschublade erachte ich als stabilisierender:",options:["Klare kategoriale Ordnung","Emergente Koexistenz"]},{title:"Bei erhöhtem Stressniveau greife ich überwiegend auf:",options:["Vertrautes Sockenduo","Funktional austauschbare Einheiten"]}],Yt=[{title:"Welche Sockenlänge präferieren Sie überwiegend im Alltag?",options:["Keine Socken","No-Show-/Invisible-Socken","Knöchellänge","Mittlere Länge (Crew)","Knielang oder darüber","Situationsabhängige Variation"]},{title:"Welche Falt- bzw. Lagerungsstrategie wenden Sie überwiegend an?",options:["Dyadische Überlappungsfaltung","Kompressionsbasierte Bündelung","Lineare Parallelfaltung","Unstrukturierte Ablage"]},{title:"Welche Farbkategorie präferieren Sie bei der Auswahl tragender Socken?",options:["Achromatische Töne","Gedämpfte Chromatik","Helle/kontrastreiche Farben","Situationsabhängige Farbwahl"]},{title:"Wie würden Sie Ihre textile Oberflächenpräferenz beschreiben?",options:["Überwiegend unifarbene Socken","Gelegentlich gemusterte Socken","Überwiegend gemusterte Socken","Muster als primäres Identitätsmerkmal"]},{title:"Inwiefern beobachten Sie eine Veränderung Ihrer affektiven Grundstimmung beim Tragen gemusterter Socken?",options:["Subjektiv wahrnehmbare Stimmungsaufhellung","Erhöhte Selbstwirksamkeits- oder Expressivitätserfahrung","Keine relevante affektive Veränderung","Keine Angabe / Trage keine gemusterten Socken"]},{title:"Inwiefern reagieren Sie auf eine unerwartete Veränderung Ihrer Sockenschubladen- oder Lagerungsstruktur?",options:["Keine subjektiv relevante Reaktion","Kurzfristige Irritation ohne Handlungsimpuls","Wahrnehmbarer Ordnungsimpuls mit Bedürfnis nach Wiederherstellung","Deutliche kognitive oder affektive Dysregulation bis zur unmittelbaren Reorganisation"]}],Qt=[{title:"Wie beschreiben Sie Ihre aktuelle Gesamtbefindlichkeit?",options:["Unverändert gegenüber dem Ausgangszustand","Leicht positiv aktiviert","Deutlich positiv aktiviert","Leicht irritiert","Deutlich irritiert","Schwer operationalisierbar"]},{title:"Falls Sie eine Veränderung wahrnehmen: Wo im Körper spüren Sie diese primär?",options:["Kopfbereich","Brust-/Herzregion","Bauch-/Abdominalregion","Extremitäten","Keine spezifische Lokalisierung"]},{title:"Hat die Bearbeitung des Fragebogens zu allgemeinen Reflexionen über Ordnung, Verlust oder Paarbildung geführt?",options:["Nein","In geringem Ausmaß","Moderat","Deutlich","In überraschend tiefgreifender Weise"]}];function se(t,e,n){const i=document.getElementById(t);if(!i)return;i.innerHTML="",e.forEach((o,a)=>{if(!o||o.length===0)return;const l=n[a];if(!l)return;const c=vo(l.title,o,l.options);i.appendChild(c)});const s=i.querySelectorAll(".visualization-card"),r=new IntersectionObserver(o=>{o.forEach(a=>{a.isIntersecting&&(a.target.classList.add("visible"),a.target.querySelectorAll(".bar-fill").forEach(l=>{l.classList.add("animate")}),r.unobserve(a.target))})},{threshold:.2});s.forEach(o=>r.observe(o))}function vo(t,e,n){const i=document.createElement("div");i.className="visualization-card",i.setAttribute("role","region"),i.setAttribute("aria-label",t);const s=n.map((r,o)=>{const a=e.find(u=>parseInt(u.option,10)===o)||{percentage:0},l=Number(a.percentage).toFixed(1),c=a.percentage>=15;return{html:`
        <div class="bar-chart-item">
          <div class="bar-label">${r}</div>
          <div class="bar-container">
            <div class="bar-fill" style="--bar-width: ${l}%" title="${l} %">
              ${c?`<span class="bar-percentage">${l} %</span>`:""}
            </div>
          </div>
          ${c?"":`<span class="bar-percentage-outside">${l} %</span>`}
        </div>
      `,percentage:Number(a.percentage)}}).sort((r,o)=>o.percentage-r.percentage).map(r=>r.html).join("");return i.innerHTML=`
    <div class="visualization-title">${t}</div>
    <div class="bar-chart">
      ${s}
    </div>
  `,i}function yo({swiper:t,extendParams:e,on:n,emit:i}){const s=eo(),r=to();t.keyboard={enabled:!1},e({keyboard:{enabled:!1,onlyInViewport:!0,pageUpDown:!0,speed:void 0}});function o(c){if(!t.enabled)return;const{rtlTranslate:u}=t;let h=c;h.originalEvent&&(h=h.originalEvent);const d=h.keyCode||h.charCode,_=t.params.keyboard.pageUpDown,m=_&&d===33,y=_&&d===34,T=d===37,f=d===39,p=d===38,v=d===40;if(!t.allowSlideNext&&(t.isHorizontal()&&f||t.isVertical()&&v||y)||!t.allowSlidePrev&&(t.isHorizontal()&&T||t.isVertical()&&p||m))return!1;if(h.shiftKey||h.altKey||h.ctrlKey||h.metaKey||s.activeElement&&(s.activeElement.isContentEditable||s.activeElement.nodeName&&(s.activeElement.nodeName.toLowerCase()==="input"||s.activeElement.nodeName.toLowerCase()==="textarea")))return;if(t.params.keyboard.onlyInViewport&&(m||y||T||f||p||v)){let O=!1;if(dn(t.el,`.${t.params.slideClass}, swiper-slide`).length>0&&dn(t.el,`.${t.params.slideActiveClass}`).length===0)return;const V=t.el,X=V.clientWidth,A=V.clientHeight,G=r.innerWidth,B=r.innerHeight,z=no(V);u&&(z.left-=V.scrollLeft);const P=[[z.left,z.top],[z.left+X,z.top],[z.left,z.top+A],[z.left+X,z.top+A]];for(let w=0;w<P.length;w+=1){const M=P[w];if(M[0]>=0&&M[0]<=G&&M[1]>=0&&M[1]<=B){if(M[0]===0&&M[1]===0)continue;O=!0}}if(!O)return}const b=t.params.keyboard.speed;t.isHorizontal()?((m||y||T||f)&&(h.preventDefault?h.preventDefault():h.returnValue=!1),((y||f)&&!u||(m||T)&&u)&&t.slideNext(b),((m||T)&&!u||(y||f)&&u)&&t.slidePrev(b)):((m||y||p||v)&&(h.preventDefault?h.preventDefault():h.returnValue=!1),(y||v)&&t.slideNext(b),(m||p)&&t.slidePrev(b)),i("keyPress",d)}function a(){t.keyboard.enabled||(s.addEventListener("keydown",o),t.keyboard.enabled=!0)}function l(){t.keyboard.enabled&&(s.removeEventListener("keydown",o),t.keyboard.enabled=!1)}n("init",()=>{t.params.keyboard.enabled&&a()}),n("destroy",()=>{t.keyboard.enabled&&l()}),Object.assign(t.keyboard,{enable:a,disable:l})}function Co(t,e,n,i){return t.params.createElements&&Object.keys(i).forEach(s=>{if(!n[s]&&n.auto===!0){let r=io(t.el,`.${i[s]}`)[0];r||(r=ys("div",i[s]),r.className=i[s],t.el.append(r)),n[s]=r,e[s]=r}}),n}function He(t=""){return`.${t.trim().replace(/([\.:!+\/()[\]#>~*^$|=,'"@{}\\])/g,"\\$1").replace(/ /g,".")}`}function bo({swiper:t,extendParams:e,on:n,emit:i}){const s="swiper-pagination";e({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:f=>f,formatFractionTotal:f=>f,bulletClass:`${s}-bullet`,bulletActiveClass:`${s}-bullet-active`,modifierClass:`${s}-`,currentClass:`${s}-current`,totalClass:`${s}-total`,hiddenClass:`${s}-hidden`,progressbarFillClass:`${s}-progressbar-fill`,progressbarOppositeClass:`${s}-progressbar-opposite`,clickableClass:`${s}-clickable`,lockClass:`${s}-lock`,horizontalClass:`${s}-horizontal`,verticalClass:`${s}-vertical`,paginationDisabledClass:`${s}-disabled`}}),t.pagination={el:null,bullets:[]};let r,o=0;function a(){return!t.params.pagination.el||!t.pagination.el||Array.isArray(t.pagination.el)&&t.pagination.el.length===0}function l(f,p){const{bulletActiveClass:v}=t.params.pagination;f&&(f=f[`${p==="prev"?"previous":"next"}ElementSibling`],f&&(f.classList.add(`${v}-${p}`),f=f[`${p==="prev"?"previous":"next"}ElementSibling`],f&&f.classList.add(`${v}-${p}-${p}`)))}function c(f,p,v){if(f=f%v,p=p%v,p===f+1)return"next";if(p===f-1)return"previous"}function u(f){const p=f.target.closest(He(t.params.pagination.bulletClass));if(!p)return;f.preventDefault();const v=Ci(p)*t.params.slidesPerGroup;if(t.params.loop){if(t.realIndex===v)return;const b=c(t.realIndex,v,t.slides.length);b==="next"?t.slideNext():b==="previous"?t.slidePrev():t.slideToLoop(v)}else t.slideTo(v)}function h(){const f=t.rtl,p=t.params.pagination;if(a())return;let v=t.pagination.el;v=ie(v);let b,O;const V=t.virtual&&t.params.virtual.enabled?t.virtual.slides.length:t.slides.length,X=t.params.loop?Math.ceil(V/t.params.slidesPerGroup):t.snapGrid.length;if(t.params.loop?(O=t.previousRealIndex||0,b=t.params.slidesPerGroup>1?Math.floor(t.realIndex/t.params.slidesPerGroup):t.realIndex):typeof t.snapIndex<"u"?(b=t.snapIndex,O=t.previousSnapIndex):(O=t.previousIndex||0,b=t.activeIndex||0),p.type==="bullets"&&t.pagination.bullets&&t.pagination.bullets.length>0){const A=t.pagination.bullets;let G,B,z;if(p.dynamicBullets&&(r=so(A[0],t.isHorizontal()?"width":"height"),v.forEach(P=>{P.style[t.isHorizontal()?"width":"height"]=`${r*(p.dynamicMainBullets+4)}px`}),p.dynamicMainBullets>1&&O!==void 0&&(o+=b-(O||0),o>p.dynamicMainBullets-1?o=p.dynamicMainBullets-1:o<0&&(o=0)),G=Math.max(b-o,0),B=G+(Math.min(A.length,p.dynamicMainBullets)-1),z=(B+G)/2),A.forEach(P=>{const w=[...["","-next","-next-next","-prev","-prev-prev","-main"].map(M=>`${p.bulletActiveClass}${M}`)].map(M=>typeof M=="string"&&M.includes(" ")?M.split(" "):M).flat();P.classList.remove(...w)}),v.length>1)A.forEach(P=>{const w=Ci(P);w===b?P.classList.add(...p.bulletActiveClass.split(" ")):t.isElement&&P.setAttribute("part","bullet"),p.dynamicBullets&&(w>=G&&w<=B&&P.classList.add(...`${p.bulletActiveClass}-main`.split(" ")),w===G&&l(P,"prev"),w===B&&l(P,"next"))});else{const P=A[b];if(P&&P.classList.add(...p.bulletActiveClass.split(" ")),t.isElement&&A.forEach((w,M)=>{w.setAttribute("part",M===b?"bullet-active":"bullet")}),p.dynamicBullets){const w=A[G],M=A[B];for(let we=G;we<=B;we+=1)A[we]&&A[we].classList.add(...`${p.bulletActiveClass}-main`.split(" "));l(w,"prev"),l(M,"next")}}if(p.dynamicBullets){const P=Math.min(A.length,p.dynamicMainBullets+4),w=(r*P-r)/2-z*r,M=f?"right":"left";A.forEach(we=>{we.style[t.isHorizontal()?M:"top"]=`${w}px`})}}v.forEach((A,G)=>{if(p.type==="fraction"&&(A.querySelectorAll(He(p.currentClass)).forEach(B=>{B.textContent=p.formatFractionCurrent(b+1)}),A.querySelectorAll(He(p.totalClass)).forEach(B=>{B.textContent=p.formatFractionTotal(X)})),p.type==="progressbar"){let B;p.progressbarOpposite?B=t.isHorizontal()?"vertical":"horizontal":B=t.isHorizontal()?"horizontal":"vertical";const z=(b+1)/X;let P=1,w=1;B==="horizontal"?P=z:w=z,A.querySelectorAll(He(p.progressbarFillClass)).forEach(M=>{M.style.transform=`translate3d(0,0,0) scaleX(${P}) scaleY(${w})`,M.style.transitionDuration=`${t.params.speed}ms`})}p.type==="custom"&&p.renderCustom?(yi(A,p.renderCustom(t,b+1,X)),G===0&&i("paginationRender",A)):(G===0&&i("paginationRender",A),i("paginationUpdate",A)),t.params.watchOverflow&&t.enabled&&A.classList[t.isLocked?"add":"remove"](p.lockClass)})}function d(){const f=t.params.pagination;if(a())return;const p=t.virtual&&t.params.virtual.enabled?t.virtual.slides.length:t.grid&&t.params.grid.rows>1?t.slides.length/Math.ceil(t.params.grid.rows):t.slides.length;let v=t.pagination.el;v=ie(v);let b="";if(f.type==="bullets"){let O=t.params.loop?Math.ceil(p/t.params.slidesPerGroup):t.snapGrid.length;t.params.freeMode&&t.params.freeMode.enabled&&O>p&&(O=p);for(let V=0;V<O;V+=1)f.renderBullet?b+=f.renderBullet.call(t,V,f.bulletClass):b+=`<${f.bulletElement} ${t.isElement?'part="bullet"':""} class="${f.bulletClass}"></${f.bulletElement}>`}f.type==="fraction"&&(f.renderFraction?b=f.renderFraction.call(t,f.currentClass,f.totalClass):b=`<span class="${f.currentClass}"></span> / <span class="${f.totalClass}"></span>`),f.type==="progressbar"&&(f.renderProgressbar?b=f.renderProgressbar.call(t,f.progressbarFillClass):b=`<span class="${f.progressbarFillClass}"></span>`),t.pagination.bullets=[],v.forEach(O=>{f.type!=="custom"&&yi(O,b||""),f.type==="bullets"&&t.pagination.bullets.push(...O.querySelectorAll(He(f.bulletClass)))}),f.type!=="custom"&&i("paginationRender",v[0])}function _(){t.params.pagination=Co(t,t.originalParams.pagination,t.params.pagination,{el:"swiper-pagination"});const f=t.params.pagination;if(!f.el)return;let p;typeof f.el=="string"&&t.isElement&&(p=t.el.querySelector(f.el)),!p&&typeof f.el=="string"&&(p=[...document.querySelectorAll(f.el)]),p||(p=f.el),!(!p||p.length===0)&&(t.params.uniqueNavElements&&typeof f.el=="string"&&Array.isArray(p)&&p.length>1&&(p=[...t.el.querySelectorAll(f.el)],p.length>1&&(p=p.find(v=>dn(v,".swiper")[0]===t.el))),Array.isArray(p)&&p.length===1&&(p=p[0]),Object.assign(t.pagination,{el:p}),p=ie(p),p.forEach(v=>{f.type==="bullets"&&f.clickable&&v.classList.add(...(f.clickableClass||"").split(" ")),v.classList.add(f.modifierClass+f.type),v.classList.add(t.isHorizontal()?f.horizontalClass:f.verticalClass),f.type==="bullets"&&f.dynamicBullets&&(v.classList.add(`${f.modifierClass}${f.type}-dynamic`),o=0,f.dynamicMainBullets<1&&(f.dynamicMainBullets=1)),f.type==="progressbar"&&f.progressbarOpposite&&v.classList.add(f.progressbarOppositeClass),f.clickable&&v.addEventListener("click",u),t.enabled||v.classList.add(f.lockClass)}))}function m(){const f=t.params.pagination;if(a())return;let p=t.pagination.el;p&&(p=ie(p),p.forEach(v=>{v.classList.remove(f.hiddenClass),v.classList.remove(f.modifierClass+f.type),v.classList.remove(t.isHorizontal()?f.horizontalClass:f.verticalClass),f.clickable&&(v.classList.remove(...(f.clickableClass||"").split(" ")),v.removeEventListener("click",u))})),t.pagination.bullets&&t.pagination.bullets.forEach(v=>v.classList.remove(...f.bulletActiveClass.split(" ")))}n("changeDirection",()=>{if(!t.pagination||!t.pagination.el)return;const f=t.params.pagination;let{el:p}=t.pagination;p=ie(p),p.forEach(v=>{v.classList.remove(f.horizontalClass,f.verticalClass),v.classList.add(t.isHorizontal()?f.horizontalClass:f.verticalClass)})}),n("init",()=>{t.params.pagination.enabled===!1?T():(_(),d(),h())}),n("activeIndexChange",()=>{typeof t.snapIndex>"u"&&h()}),n("snapIndexChange",()=>{h()}),n("snapGridLengthChange",()=>{d(),h()}),n("destroy",()=>{m()}),n("enable disable",()=>{let{el:f}=t.pagination;f&&(f=ie(f),f.forEach(p=>p.classList[t.enabled?"remove":"add"](t.params.pagination.lockClass)))}),n("lock unlock",()=>{h()}),n("click",(f,p)=>{const v=p.target,b=ie(t.pagination.el);if(t.params.pagination.el&&t.params.pagination.hideOnClick&&b&&b.length>0&&!v.classList.contains(t.params.pagination.bulletClass)){if(t.navigation&&(t.navigation.nextEl&&v===t.navigation.nextEl||t.navigation.prevEl&&v===t.navigation.prevEl))return;const O=b[0].classList.contains(t.params.pagination.hiddenClass);i(O===!0?"paginationShow":"paginationHide"),b.forEach(V=>V.classList.toggle(t.params.pagination.hiddenClass))}});const y=()=>{t.el.classList.remove(t.params.pagination.paginationDisabledClass);let{el:f}=t.pagination;f&&(f=ie(f),f.forEach(p=>p.classList.remove(t.params.pagination.paginationDisabledClass))),_(),d(),h()},T=()=>{t.el.classList.add(t.params.pagination.paginationDisabledClass);let{el:f}=t.pagination;f&&(f=ie(f),f.forEach(p=>p.classList.add(t.params.pagination.paginationDisabledClass))),m()};Object.assign(t.pagination,{enable:y,disable:T,render:d,update:h,init:_,destroy:m})}function Eo(t){const{effect:e,swiper:n,on:i,setTranslate:s,setTransition:r,overwriteParams:o,perspective:a,recreateShadows:l,getEffectParams:c}=t;i("beforeInit",()=>{if(n.params.effect!==e)return;n.classNames.push(`${n.params.containerModifierClass}${e}`),a&&a()&&n.classNames.push(`${n.params.containerModifierClass}3d`);const h=o?o():{};Object.assign(n.params,h),Object.assign(n.originalParams,h)}),i("setTranslate _virtualUpdated",()=>{n.params.effect===e&&s()}),i("setTransition",(h,d)=>{n.params.effect===e&&r(d)}),i("transitionEnd",()=>{if(n.params.effect===e&&l){if(!c||!c().slideShadows)return;n.slides.forEach(h=>{h.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(d=>d.remove())}),l()}});let u;i("virtualUpdate",()=>{n.params.effect===e&&(n.slides.length||(u=!0),requestAnimationFrame(()=>{u&&n.slides&&n.slides.length&&(s(),u=!1)}))})}function Io(t,e){const n=Mn(e);return n!==e&&(n.style.backfaceVisibility="hidden",n.style["-webkit-backface-visibility"]="hidden"),n}function So({swiper:t,duration:e,transformElements:n,allSlides:i}){const{activeIndex:s}=t,r=o=>o.parentElement?o.parentElement:t.slides.find(l=>l.shadowRoot&&l.shadowRoot===o.parentNode);if(t.params.virtualTranslate&&e!==0){let o=!1,a;i?a=n:a=n.filter(l=>{const c=l.classList.contains("swiper-slide-transform")?r(l):l;return t.getSlideIndex(c)===s}),a.forEach(l=>{ro(l,()=>{if(o||!t||t.destroyed)return;o=!0,t.animating=!1;const c=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0});t.wrapperEl.dispatchEvent(c)})})}}function To(t,e,n){const i=`swiper-slide-shadow${` swiper-slide-shadow-${t}`}`,s=Mn(e);let r=s.querySelector(`.${i.split(" ").join(".")}`);return r||(r=ys("div",i.split(" ")),s.append(r)),r}function wo({swiper:t,extendParams:e,on:n}){e({cardsEffect:{slideShadows:!0,rotate:!0,perSlideRotate:2,perSlideOffset:8}}),Eo({effect:"cards",swiper:t,on:n,setTranslate:()=>{const{slides:r,activeIndex:o,rtlTranslate:a}=t,l=t.params.cardsEffect,{startTranslate:c,isTouched:u}=t.touchEventsData,h=a?-t.translate:t.translate;for(let d=0;d<r.length;d+=1){const _=r[d],m=_.progress,y=Math.min(Math.max(m,-4),4);let T=_.swiperSlideOffset;t.params.centeredSlides&&!t.params.cssMode&&(t.wrapperEl.style.transform=`translateX(${t.minTranslate()}px)`),t.params.centeredSlides&&t.params.cssMode&&(T-=r[0].swiperSlideOffset);let f=t.params.cssMode?-T-t.translate:-T,p=0;const v=-100*Math.abs(y);let b=1,O=-l.perSlideRotate*y,V=l.perSlideOffset-Math.abs(y)*.75;const X=t.virtual&&t.params.virtual.enabled?t.virtual.from+d:d,A=(X===o||X===o-1)&&y>0&&y<1&&(u||t.params.cssMode)&&h<c,G=(X===o||X===o+1)&&y<0&&y>-1&&(u||t.params.cssMode)&&h>c;if(A||G){const w=(1-Math.abs((Math.abs(y)-.5)/.5))**.5;O+=-28*y*w,b+=-.5*w,V+=96*w,p=`${(l.rotate||t.isHorizontal()?-25:0)*w*Math.abs(y)}%`}if(y<0?f=`calc(${f}px ${a?"-":"+"} (${V*Math.abs(y)}%))`:y>0?f=`calc(${f}px ${a?"-":"+"} (-${V*Math.abs(y)}%))`:f=`${f}px`,!t.isHorizontal()){const w=p;p=f,f=w}const B=y<0?`${1+(1-b)*y}`:`${1-(1-b)*y}`,z=`
        translate3d(${f}, ${p}, ${v}px)
        rotateZ(${l.rotate?a?-O:O:0}deg)
        scale(${B})
      `;if(l.slideShadows){let w=_.querySelector(".swiper-slide-shadow");w||(w=To("cards",_)),w&&(w.style.opacity=Math.min(Math.max((Math.abs(y)-.5)/.5,0),1))}_.style.zIndex=-Math.abs(Math.round(m))+r.length;const P=Io(l,_);P.style.transform=z}},setTransition:r=>{const o=t.slides.map(a=>Mn(a));o.forEach(a=>{a.style.transitionDuration=`${r}ms`,a.querySelectorAll(".swiper-slide-shadow").forEach(l=>{l.style.transitionDuration=`${r}ms`})}),So({swiper:t,duration:r,transformElements:o})},perspective:()=>!0,overwriteParams:()=>({_loopSwapReset:!1,watchSlidesProgress:!0,loopAdditionalSlides:t.params.cardsEffect.rotate?3:2,centeredSlides:!0,virtualTranslate:!t.params.cssMode})})}const ko=()=>{};var Ii={};const Cs={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const g=function(t,e){if(!t)throw Be(e)},Be=function(t){return new Error("Firebase Database ("+Cs.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};const bs=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&i+1<t.length&&(t.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++i)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},No=function(t){const e=[];let n=0,i=0;for(;n<t.length;){const s=t[n++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=t[n++];e[i++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){const r=t[n++],o=t[n++],a=t[n++],l=((s&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{const r=t[n++],o=t[n++];e[i++]=String.fromCharCode((s&15)<<12|(r&63)<<6|o&63)}}return e.join("")},On={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<t.length;s+=3){const r=t[s],o=s+1<t.length,a=o?t[s+1]:0,l=s+2<t.length,c=l?t[s+2]:0,u=r>>2,h=(r&3)<<4|a>>4;let d=(a&15)<<2|c>>6,_=c&63;l||(_=64,o||(d=64)),i.push(n[u],n[h],n[d],n[_])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(bs(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):No(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<t.length;){const r=n[t.charAt(s++)],a=s<t.length?n[t.charAt(s)]:0;++s;const c=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,r==null||a==null||c==null||h==null)throw new Ao;const d=r<<2|a>>4;if(i.push(d),c!==64){const _=a<<4&240|c>>2;if(i.push(_),h!==64){const m=c<<6&192|h;i.push(m)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Ao extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Es=function(t){const e=bs(t);return On.encodeByteArray(e,!0)},yt=function(t){return Es(t).replace(/\./g,"")},fn=function(t){try{return On.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Ro(t){return Is(void 0,t)}function Is(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!xo(n)||(t[n]=Is(t[n],e[n]));return t}function xo(t){return t!=="__proto__"}function Do(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Po=()=>Do().__FIREBASE_DEFAULTS__,Lo=()=>{if(typeof process>"u"||typeof Ii>"u")return;const t=Ii.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Mo=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&fn(t[1]);return e&&JSON.parse(e)},Ss=()=>{try{return ko()||Po()||Lo()||Mo()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Oo=t=>Ss()?.emulatorHosts?.[t],Fo=t=>{const e=Oo(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),i]:[e.substring(0,n),i]},Ts=()=>Ss()?.config;class Ot{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,i)=>{n?this.reject(n):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,i))}}}function Fn(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Bo(t){return(await fetch(t,{credentials:"include"})).ok}function $o(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},i=e||"demo-project",s=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...t};return[yt(JSON.stringify(n)),yt(JSON.stringify(o)),""].join(".")}const qe={};function Ho(){const t={prod:[],emulator:[]};for(const e of Object.keys(qe))qe[e]?t.emulator.push(e):t.prod.push(e);return t}function Wo(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Si=!1;function zo(t,e){if(typeof window>"u"||typeof document>"u"||!Fn(window.location.host)||qe[t]===e||qe[t]||Si)return;qe[t]=e;function n(d){return`__firebase__banner__${d}`}const i="__firebase__banner",r=Ho().prod.length>0;function o(){const d=document.getElementById(i);d&&d.remove()}function a(d){d.style.display="flex",d.style.background="#7faaf0",d.style.position="fixed",d.style.bottom="5px",d.style.left="5px",d.style.padding=".5em",d.style.borderRadius="5px",d.style.alignItems="center"}function l(d,_){d.setAttribute("width","24"),d.setAttribute("id",_),d.setAttribute("height","24"),d.setAttribute("viewBox","0 0 24 24"),d.setAttribute("fill","none"),d.style.marginLeft="-6px"}function c(){const d=document.createElement("span");return d.style.cursor="pointer",d.style.marginLeft="16px",d.style.fontSize="24px",d.innerHTML=" &times;",d.onclick=()=>{Si=!0,o()},d}function u(d,_){d.setAttribute("id",_),d.innerText="Learn more",d.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",d.setAttribute("target","__blank"),d.style.paddingLeft="5px",d.style.textDecoration="underline"}function h(){const d=Wo(i),_=n("text"),m=document.getElementById(_)||document.createElement("span"),y=n("learnmore"),T=document.getElementById(y)||document.createElement("a"),f=n("preprendIcon"),p=document.getElementById(f)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(d.created){const v=d.element;a(v),u(T,y);const b=c();l(p,f),v.append(p,m,T,b),document.body.appendChild(v)}r?(m.innerText="Preview backend disconnected.",p.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(p.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,m.innerText="Preview backend running in this workspace."),m.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}function Uo(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ws(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Uo())}function Vo(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function qo(){return Cs.NODE_ADMIN===!0}function Go(){try{return typeof indexedDB=="object"}catch{return!1}}function jo(){return new Promise((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(n){e(n)}})}const Ko="FirebaseError";class at extends Error{constructor(e,n,i){super(n),this.code=e,this.customData=i,this.name=Ko,Object.setPrototypeOf(this,at.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ks.prototype.create)}}class ks{constructor(e,n,i){this.service=e,this.serviceName=n,this.errors=i}create(e,...n){const i=n[0]||{},s=`${this.service}/${e}`,r=this.errors[e],o=r?Yo(r,i):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new at(s,a,i)}}function Yo(t,e){return t.replace(Qo,(n,i)=>{const s=e[i];return s!=null?String(s):`<${i}?>`})}const Qo=/\{\$([^}]+)}/g;function Xe(t){return JSON.parse(t)}function W(t){return JSON.stringify(t)}const Ns=function(t){let e={},n={},i={},s="";try{const r=t.split(".");e=Xe(fn(r[0])||""),n=Xe(fn(r[1])||""),s=r[2],i=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:i,signature:s}},Xo=function(t){const e=Ns(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},Jo=function(t){const e=Ns(t).claims;return typeof e=="object"&&e.admin===!0};function ne(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ye(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function Ti(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ct(t,e,n){const i={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=e.call(n,t[s],s,t));return i}function bt(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const s of n){if(!i.includes(s))return!1;const r=t[s],o=e[s];if(wi(r)&&wi(o)){if(!bt(r,o))return!1}else if(r!==o)return!1}for(const s of i)if(!n.includes(s))return!1;return!0}function wi(t){return t!==null&&typeof t=="object"}function Zo(t){const e=[];for(const[n,i]of Object.entries(t))Array.isArray(i)?i.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}class ea{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const i=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)i[h]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let h=0;h<16;h++)i[h]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let h=16;h<80;h++){const d=i[h-3]^i[h-8]^i[h-14]^i[h-16];i[h]=(d<<1|d>>>31)&4294967295}let s=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],c,u;for(let h=0;h<80;h++){h<40?h<20?(c=a^r&(o^a),u=1518500249):(c=r^o^a,u=1859775393):h<60?(c=r&o|a&(r|o),u=2400959708):(c=r^o^a,u=3395469782);const d=(s<<5|s>>>27)+c+l+u+i[h]&4294967295;l=a,a=o,o=(r<<30|r>>>2)&4294967295,r=s,s=d}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const i=n-this.blockSize;let s=0;const r=this.buf_;let o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=i;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(r[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}else for(;s<n;)if(r[o]=e[s],++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let r=24;r>=0;r-=8)e[i]=this.chain_[s]>>r&255,++i;return e}}function As(t,e){return`${t} failed: ${e} argument `}const ta=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);if(s>=55296&&s<=56319){const r=s-55296;i++,g(i<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(i)-56320;s=65536+(r<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},Ft=function(t){let e=0;for(let n=0;n<t.length;n++){const i=t.charCodeAt(n);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,n++):e+=3}return e};function lt(t){return t&&t._delegate?t._delegate:t}class Je{constructor(e,n,i){this.name=e,this.instanceFactory=n,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ge="[DEFAULT]";class na{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const i=new Ot;if(this.instancesDeferred.set(n,i),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),i=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(sa(e))try{this.getOrInitializeService({instanceIdentifier:ge})}catch{}for(const[n,i]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const r=this.getOrInitializeService({instanceIdentifier:s});i.resolve(r)}catch{}}}}clearInstance(e=ge){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ge){return this.instances.has(e)}getOptions(e=ge){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:n});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);i===a&&o.resolve(s)}return s}onInit(e,n){const i=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(i)??new Set;s.add(e),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&e(r,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const i=this.onInitCallbacks.get(n);if(i)for(const s of i)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:ia(e),options:n}),this.instances.set(e,i),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=ge){return this.component?this.component.multipleInstances?e:ge:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function ia(t){return t===ge?void 0:t}function sa(t){return t.instantiationMode==="EAGER"}class ra{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new na(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var R;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(R||(R={}));const oa={debug:R.DEBUG,verbose:R.VERBOSE,info:R.INFO,warn:R.WARN,error:R.ERROR,silent:R.SILENT},aa=R.INFO,la={[R.DEBUG]:"log",[R.VERBOSE]:"log",[R.INFO]:"info",[R.WARN]:"warn",[R.ERROR]:"error"},ca=(t,e,...n)=>{if(e<t.logLevel)return;const i=new Date().toISOString(),s=la[e];if(s)console[s](`[${i}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Rs{constructor(e){this.name=e,this._logLevel=aa,this._logHandler=ca,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in R))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?oa[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,R.DEBUG,...e),this._logHandler(this,R.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,R.VERBOSE,...e),this._logHandler(this,R.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,R.INFO,...e),this._logHandler(this,R.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,R.WARN,...e),this._logHandler(this,R.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,R.ERROR,...e),this._logHandler(this,R.ERROR,...e)}}const ha=(t,e)=>e.some(n=>t instanceof n);let ki,Ni;function da(){return ki||(ki=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ua(){return Ni||(Ni=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const xs=new WeakMap,pn=new WeakMap,Ds=new WeakMap,Xt=new WeakMap,Bn=new WeakMap;function fa(t){const e=new Promise((n,i)=>{const s=()=>{t.removeEventListener("success",r),t.removeEventListener("error",o)},r=()=>{n(he(t.result)),s()},o=()=>{i(t.error),s()};t.addEventListener("success",r),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&xs.set(n,t)}).catch(()=>{}),Bn.set(e,t),e}function pa(t){if(pn.has(t))return;const e=new Promise((n,i)=>{const s=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",o),t.removeEventListener("abort",o)},r=()=>{n(),s()},o=()=>{i(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",r),t.addEventListener("error",o),t.addEventListener("abort",o)});pn.set(t,e)}let _n={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return pn.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Ds.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return he(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function _a(t){_n=t(_n)}function ga(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const i=t.call(Jt(this),e,...n);return Ds.set(i,e.sort?e.sort():[e]),he(i)}:ua().includes(t)?function(...e){return t.apply(Jt(this),e),he(xs.get(this))}:function(...e){return he(t.apply(Jt(this),e))}}function ma(t){return typeof t=="function"?ga(t):(t instanceof IDBTransaction&&pa(t),ha(t,da())?new Proxy(t,_n):t)}function he(t){if(t instanceof IDBRequest)return fa(t);if(Xt.has(t))return Xt.get(t);const e=ma(t);return e!==t&&(Xt.set(t,e),Bn.set(e,t)),e}const Jt=t=>Bn.get(t);function va(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=he(o);return i&&o.addEventListener("upgradeneeded",l=>{i(he(o.result),l.oldVersion,l.newVersion,he(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const ya=["get","getKey","getAll","getAllKeys","count"],Ca=["put","add","delete","clear"],Zt=new Map;function Ai(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Zt.get(e))return Zt.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=Ca.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(s||ya.includes(n)))return;const r=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return i&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),s&&l.done]))[0]};return Zt.set(e,r),r}_a(t=>({...t,get:(e,n,i)=>Ai(e,n)||t.get(e,n,i),has:(e,n)=>!!Ai(e,n)||t.has(e,n)}));class ba{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Ea(n)){const i=n.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(n=>n).join(" ")}}function Ea(t){return t.getComponent()?.type==="VERSION"}const gn="@firebase/app",Ri="0.14.8";const ae=new Rs("@firebase/app"),Ia="@firebase/app-compat",Sa="@firebase/analytics-compat",Ta="@firebase/analytics",wa="@firebase/app-check-compat",ka="@firebase/app-check",Na="@firebase/auth",Aa="@firebase/auth-compat",Ra="@firebase/database",xa="@firebase/data-connect",Da="@firebase/database-compat",Pa="@firebase/functions",La="@firebase/functions-compat",Ma="@firebase/installations",Oa="@firebase/installations-compat",Fa="@firebase/messaging",Ba="@firebase/messaging-compat",$a="@firebase/performance",Ha="@firebase/performance-compat",Wa="@firebase/remote-config",za="@firebase/remote-config-compat",Ua="@firebase/storage",Va="@firebase/storage-compat",qa="@firebase/firestore",Ga="@firebase/ai",ja="@firebase/firestore-compat",Ka="firebase",Ya="12.9.0";const mn="[DEFAULT]",Qa={[gn]:"fire-core",[Ia]:"fire-core-compat",[Ta]:"fire-analytics",[Sa]:"fire-analytics-compat",[ka]:"fire-app-check",[wa]:"fire-app-check-compat",[Na]:"fire-auth",[Aa]:"fire-auth-compat",[Ra]:"fire-rtdb",[xa]:"fire-data-connect",[Da]:"fire-rtdb-compat",[Pa]:"fire-fn",[La]:"fire-fn-compat",[Ma]:"fire-iid",[Oa]:"fire-iid-compat",[Fa]:"fire-fcm",[Ba]:"fire-fcm-compat",[$a]:"fire-perf",[Ha]:"fire-perf-compat",[Wa]:"fire-rc",[za]:"fire-rc-compat",[Ua]:"fire-gcs",[Va]:"fire-gcs-compat",[qa]:"fire-fst",[ja]:"fire-fst-compat",[Ga]:"fire-vertex","fire-js":"fire-js",[Ka]:"fire-js-all"};const Et=new Map,Xa=new Map,vn=new Map;function xi(t,e){try{t.container.addComponent(e)}catch(n){ae.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function It(t){const e=t.name;if(vn.has(e))return ae.debug(`There were multiple attempts to register component ${e}.`),!1;vn.set(e,t);for(const n of Et.values())xi(n,t);for(const n of Xa.values())xi(n,t);return!0}function Ja(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Za(t){return t==null?!1:t.settings!==void 0}const el={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},de=new ks("app","Firebase",el);class tl{constructor(e,n,i){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Je("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw de.create("app-deleted",{appName:this._name})}}const nl=Ya;function Ps(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const i={name:mn,automaticDataCollectionEnabled:!0,...e},s=i.name;if(typeof s!="string"||!s)throw de.create("bad-app-name",{appName:String(s)});if(n||(n=Ts()),!n)throw de.create("no-options");const r=Et.get(s);if(r){if(bt(n,r.options)&&bt(i,r.config))return r;throw de.create("duplicate-app",{appName:s})}const o=new ra(s);for(const l of vn.values())o.addComponent(l);const a=new tl(n,i,o);return Et.set(s,a),a}function il(t=mn){const e=Et.get(t);if(!e&&t===mn&&Ts())return Ps();if(!e)throw de.create("no-app",{appName:t});return e}function xe(t,e,n){let i=Qa[t]??t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),r=e.match(/\s|\//);if(s||r){const o=[`Unable to register library "${i}" with version "${e}":`];s&&o.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&r&&o.push("and"),r&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ae.warn(o.join(" "));return}It(new Je(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}const sl="firebase-heartbeat-database",rl=1,Ze="firebase-heartbeat-store";let en=null;function Ls(){return en||(en=va(sl,rl,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Ze)}catch(n){console.warn(n)}}}}).catch(t=>{throw de.create("idb-open",{originalErrorMessage:t.message})})),en}async function ol(t){try{const n=(await Ls()).transaction(Ze),i=await n.objectStore(Ze).get(Ms(t));return await n.done,i}catch(e){if(e instanceof at)ae.warn(e.message);else{const n=de.create("idb-get",{originalErrorMessage:e?.message});ae.warn(n.message)}}}async function Di(t,e){try{const i=(await Ls()).transaction(Ze,"readwrite");await i.objectStore(Ze).put(e,Ms(t)),await i.done}catch(n){if(n instanceof at)ae.warn(n.message);else{const i=de.create("idb-set",{originalErrorMessage:n?.message});ae.warn(i.message)}}}function Ms(t){return`${t.name}!${t.options.appId}`}const al=1024,ll=30;class cl{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new dl(n),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Pi();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(s=>s.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>ll){const s=ul(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ae.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Pi(),{heartbeatsToSend:n,unsentEntries:i}=hl(this._heartbeatsCache.heartbeats),s=yt(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return ae.warn(e),""}}}function Pi(){return new Date().toISOString().substring(0,10)}function hl(t,e=al){const n=[];let i=t.slice();for(const s of t){const r=n.find(o=>o.agent===s.agent);if(r){if(r.dates.push(s.date),Li(n)>e){r.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Li(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}class dl{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Go()?jo().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await ol(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return Di(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return Di(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Li(t){return yt(JSON.stringify({version:2,heartbeats:t})).length}function ul(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let i=1;i<t.length;i++)t[i].date<n&&(n=t[i].date,e=i);return e}function fl(t){It(new Je("platform-logger",e=>new ba(e),"PRIVATE")),It(new Je("heartbeat",e=>new cl(e),"PRIVATE")),xe(gn,Ri,t),xe(gn,Ri,"esm2020"),xe("fire-js","")}fl("");var pl="firebase",_l="12.9.0";xe(pl,_l,"app");var Mi={};const Oi="@firebase/database",Fi="1.1.0";let Os="";function gl(t){Os=t}class ml{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),W(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:Xe(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class vl{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return ne(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Fs=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new ml(e)}}catch{}return new vl},ve=Fs("localStorage"),yl=Fs("sessionStorage");const De=new Rs("@firebase/database"),Bs=(function(){let t=1;return function(){return t++}})(),$s=function(t){const e=ta(t),n=new ea;n.update(e);const i=n.digest();return On.encodeByteArray(i)},ct=function(...t){let e="";for(let n=0;n<t.length;n++){const i=t[n];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=ct.apply(null,i):typeof i=="object"?e+=W(i):e+=i,e+=" "}return e};let Ge=null,Bi=!0;const Cl=function(t,e){g(!0,"Can't turn on custom loggers persistently."),De.logLevel=R.VERBOSE,Ge=De.log.bind(De)},q=function(...t){if(Bi===!0&&(Bi=!1,Ge===null&&yl.get("logging_enabled")===!0&&Cl()),Ge){const e=ct.apply(null,t);Ge(e)}},ht=function(t){return function(...e){q(t,...e)}},yn=function(...t){const e="FIREBASE INTERNAL ERROR: "+ct(...t);De.error(e)},le=function(...t){const e=`FIREBASE FATAL ERROR: ${ct(...t)}`;throw De.error(e),new Error(e)},Q=function(...t){const e="FIREBASE WARNING: "+ct(...t);De.warn(e)},bl=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Q("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},$n=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},El=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Me="[MIN_NAME]",Ce="[MAX_NAME]",$e=function(t,e){if(t===e)return 0;if(t===Me||e===Ce)return-1;if(e===Me||t===Ce)return 1;{const n=$i(t),i=$i(e);return n!==null?i!==null?n-i===0?t.length-e.length:n-i:-1:i!==null?1:t<e?-1:1}},Il=function(t,e){return t===e?0:t<e?-1:1},We=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+W(e))},Hn=function(t){if(typeof t!="object"||t===null)return W(t);const e=[];for(const i in t)e.push(i);e.sort();let n="{";for(let i=0;i<e.length;i++)i!==0&&(n+=","),n+=W(e[i]),n+=":",n+=Hn(t[e[i]]);return n+="}",n},Hs=function(t,e){const n=t.length;if(n<=e)return[t];const i=[];for(let s=0;s<n;s+=e)s+e>n?i.push(t.substring(s,n)):i.push(t.substring(s,s+e));return i};function Y(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Ws=function(t){g(!$n(t),"Invalid JSON number");const e=11,n=52,i=(1<<e-1)-1;let s,r,o,a,l;t===0?(r=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),i),r=a+i,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(r=0,o=Math.round(t/Math.pow(2,1-i-n))));const c=[];for(l=n;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(s?1:0),c.reverse();const u=c.join("");let h="";for(l=0;l<64;l+=8){let d=parseInt(u.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},Sl=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Tl=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function wl(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const i=new Error(t+" at "+e._path.toString()+": "+n);return i.code=t.toUpperCase(),i}const kl=new RegExp("^-?(0*)\\d{1,10}$"),Nl=-2147483648,Al=2147483647,$i=function(t){if(kl.test(t)){const e=Number(t);if(e>=Nl&&e<=Al)return e}return null},dt=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw Q("Exception was thrown by user callback.",n),e},Math.floor(0))}},Rl=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},je=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};class xl{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,Za(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n?.getImmediate({optional:!0}),this.appCheck||n?.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){Q(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Dl{constructor(e,n,i){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(q("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Q(e)}}class vt{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}vt.OWNER="owner";const Wn="5",zs="v",Us="s",Vs="r",qs="f",Gs=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,js="ls",Ks="p",Cn="ac",Ys="websocket",Qs="long_polling";class Xs{constructor(e,n,i,s,r=!1,o="",a=!1,l=!1,c=null){this.secure=n,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ve.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ve.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function Pl(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Js(t,e,n){g(typeof e=="string","typeof type must == string"),g(typeof n=="object","typeof params must == object");let i;if(e===Ys)i=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Qs)i=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Pl(t)&&(n.ns=t.namespace);const s=[];return Y(n,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}class Ll{constructor(){this.counters_={}}incrementCounter(e,n=1){ne(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return Ro(this.counters_)}}const tn={},nn={};function zn(t){const e=t.toString();return tn[e]||(tn[e]=new Ll),tn[e]}function Ml(t,e){const n=t.toString();return nn[n]||(nn[n]=e()),nn[n]}class Ol{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&dt(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Hi="start",Fl="close",Bl="pLPCommand",$l="pRTLPCB",Zs="id",er="pw",tr="ser",Hl="cb",Wl="seg",zl="ts",Ul="d",Vl="dframe",nr=1870,ir=30,ql=nr-ir,Gl=25e3,jl=3e4;class Ae{constructor(e,n,i,s,r,o,a){this.connId=e,this.repoInfo=n,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ht(e),this.stats_=zn(n),this.urlFn=l=>(this.appCheckToken&&(l[Cn]=this.appCheckToken),Js(n,Qs,l))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new Ol(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(jl)),El(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Un((...r)=>{const[o,a,l,c,u]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Hi)this.id=a,this.password=l;else if(o===Fl)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={};i[Hi]="t",i[tr]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[Hl]=this.scriptTagHolder.uniqueCallbackIdentifier),i[zs]=Wn,this.transportSessionId&&(i[Us]=this.transportSessionId),this.lastSessionId&&(i[js]=this.lastSessionId),this.applicationId&&(i[Ks]=this.applicationId),this.appCheckToken&&(i[Cn]=this.appCheckToken),typeof location<"u"&&location.hostname&&Gs.test(location.hostname)&&(i[Vs]=qs);const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ae.forceAllow_=!0}static forceDisallow(){Ae.forceDisallow_=!0}static isAvailable(){return Ae.forceAllow_?!0:!Ae.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Sl()&&!Tl()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=W(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const i=Es(n),s=Hs(i,ql);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const i={};i[Vl]="t",i[Zs]=e,i[er]=n,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=W(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class Un{constructor(e,n,i,s){this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Bs(),window[Bl+this.uniqueCallbackIdentifier]=e,window[$l+this.uniqueCallbackIdentifier]=n,this.myIFrame=Un.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){q("frame writing exception"),a.stack&&q(a.stack),q(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||q("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Zs]=this.myID,e[er]=this.myPW,e[tr]=this.currentSerial;let n=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+ir+i.length<=nr;){const o=this.pendingSegs.shift();i=i+"&"+Wl+s+"="+o.seg+"&"+zl+s+"="+o.ts+"&"+Ul+s+"="+o.d,s++}return n=n+i,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,i){this.pendingSegs.push({seg:e,ts:n,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const i=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(i,Math.floor(Gl)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),n())},i.onerror=()=>{q("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}const Kl=16384,Yl=45e3;let St=null;typeof MozWebSocket<"u"?St=MozWebSocket:typeof WebSocket<"u"&&(St=WebSocket);class J{constructor(e,n,i,s,r,o,a){this.connId=e,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ht(this.connId),this.stats_=zn(n),this.connURL=J.connectionURL_(n,o,a,s,i),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,i,s,r){const o={};return o[zs]=Wn,typeof location<"u"&&location.hostname&&Gs.test(location.hostname)&&(o[Vs]=qs),n&&(o[Us]=n),i&&(o[js]=i),s&&(o[Cn]=s),r&&(o[Ks]=r),Js(e,Ys,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ve.set("previous_websocket_failure",!0);try{let i;qo(),this.mySock=new St(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){J.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(n);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&St!==null&&!J.forceDisallow_}static previouslyFailed(){return ve.isInMemoryStorage||ve.get("previous_websocket_failure")===!0}markConnectionHealthy(){ve.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const i=Xe(n);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(g(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const i=this.extractFrameCount_(n);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const n=W(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const i=Hs(n,Kl);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Yl))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}J.responsesRequiredToBeHealthy=2;J.healthyTimeout=3e4;class et{static get ALL_TRANSPORTS(){return[Ae,J]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=J&&J.isAvailable();let i=n&&!J.previouslyFailed();if(e.webSocketOnly&&(n||Q("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[J];else{const s=this.transports_=[];for(const r of et.ALL_TRANSPORTS)r&&r.isAvailable()&&s.push(r);et.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}et.globalTransportInitialized_=!1;const Ql=6e4,Xl=5e3,Jl=10*1024,Zl=100*1024,sn="t",Wi="d",ec="s",zi="r",tc="e",Ui="o",Vi="a",qi="n",Gi="p",nc="h";class ic{constructor(e,n,i,s,r,o,a,l,c,u){this.id=e,this.repoInfo_=n,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ht("c:"+this.id+":"),this.transportManager_=new et(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,i)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=je(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Zl?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Jl?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(sn in e){const n=e[sn];n===Vi?this.upgradeIfSecondaryHealthy_():n===zi?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===Ui&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=We("t",e),i=We("d",e);if(n==="c")this.onSecondaryControl_(i);else if(n==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Gi,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Vi,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:qi,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=We("t",e),i=We("d",e);n==="c"?this.onControl_(i):n==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=We(sn,e);if(Wi in e){const i=e[Wi];if(n===nc){const s={...i};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===qi){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===ec?this.onConnectionShutdown_(i):n===zi?this.onReset_(i):n===tc?yn("Server Error: "+i):n===Ui?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):yn("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Wn!==i&&Q("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,i),je(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Ql))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):je(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Xl))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Gi,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ve.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class sr{put(e,n,i,s){}merge(e,n,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,i){}onDisconnectMerge(e,n,i){}onDisconnectCancel(e,n){}reportStats(e){}}class rr{constructor(e){this.allowedEvents_=e,this.listeners_={},g(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,n)}}on(e,n,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:i});const s=this.getInitialEvent(e);s&&n.apply(i,s)}off(e,n,i){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===n&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){g(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}class Tt extends rr{static getInstance(){return new Tt}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!ws()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return g(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const ji=32,Ki=768;class N{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function k(){return new N("")}function E(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function fe(t){return t.pieces_.length-t.pieceNum_}function x(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new N(t.pieces_,e)}function or(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function sc(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function ar(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function lr(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new N(e,0)}function F(t,e){const n=[];for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);if(e instanceof N)for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);else{const i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&n.push(i[s])}return new N(n,0)}function S(t){return t.pieceNum_>=t.pieces_.length}function j(t,e){const n=E(t),i=E(e);if(n===null)return e;if(n===i)return j(x(t),x(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Vn(t,e){if(fe(t)!==fe(e))return!1;for(let n=t.pieceNum_,i=e.pieceNum_;n<=t.pieces_.length;n++,i++)if(t.pieces_[n]!==e.pieces_[i])return!1;return!0}function Z(t,e){let n=t.pieceNum_,i=e.pieceNum_;if(fe(t)>fe(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[i])return!1;++n,++i}return!0}class rc{constructor(e,n){this.errorPrefix_=n,this.parts_=ar(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Ft(this.parts_[i]);cr(this)}}function oc(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Ft(e),cr(t)}function ac(t){const e=t.parts_.pop();t.byteLength_-=Ft(e),t.parts_.length>0&&(t.byteLength_-=1)}function cr(t){if(t.byteLength_>Ki)throw new Error(t.errorPrefix_+"has a key path longer than "+Ki+" bytes ("+t.byteLength_+").");if(t.parts_.length>ji)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ji+") or object contains a cycle "+me(t))}function me(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}class qn extends rr{static getInstance(){return new qn}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return g(e==="visible","Unknown event type: "+e),[this.visible_]}}const ze=1e3,lc=300*1e3,Yi=30*1e3,cc=1.3,hc=3e4,dc="server_kill",Qi=3;class oe extends sr{constructor(e,n,i,s,r,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=oe.nextPersistentConnectionId_++,this.log_=ht("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ze,this.maxReconnectDelay_=lc,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");qn.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Tt.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,i){const s=++this.requestNumber_,r={r:s,a:e,b:n};this.log_(W(r)),g(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();const n=new Ot,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),n.promise}listen(e,n,i,s){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),g(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),g(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:n,query:e,tag:i};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(i)})}sendListen_(e){const n=e.query,i=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+i+" for "+s);const r={p:i},o="q";e.tag&&(r.q=n._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,a=>{const l=a.d,c=a.s;oe.warnOnListenWarnings_(l,n),(this.listens.get(i)&&this.listens.get(i).get(s))===e&&(this.log_("listen response",a),c!=="ok"&&this.removeListen_(i,s),e.onComplete&&e.onComplete(c,l))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&ne(e,"w")){const i=ye(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',r=n._path.toString();Q(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Jo(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Yi)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=Xo(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(n,i,s=>{const r=s.s,o=s.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,i=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,i)})}unlisten(e,n){const i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),g(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,n)}sendUnlisten_(e,n,i,s){this.log_("Unlisten on "+e+" for "+n);const r={p:e},o="n";s&&(r.q=i,r.t=s),this.sendRequest(o,r)}onDisconnectPut(e,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:i})}onDisconnectMerge(e,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:i})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,i,s){const r={p:n,d:i};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,n,i,s){this.putInternal("p",e,n,i,s)}merge(e,n,i,s){this.putInternal("m",e,n,i,s)}putInternal(e,n,i,s,r){this.initConnection_();const o={p:n,d:i};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,i,r=>{this.log_(n+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(r.s,r.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,i=>{if(i.s!=="ok"){const r=i.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+W(e));const n=e.r,i=this.requestCBHash_[n];i&&(delete this.requestCBHash_[n],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):yn("Unrecognized action received from server: "+W(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){g(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ze,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=ze,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>hc&&(this.reconnectDelay_=ze),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*cc)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+oe.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,i())},c=function(h){g(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(h)};this.realtime_={close:l,sendRequest:c};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,d]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?q("getToken() completed but was canceled"):(q("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=d&&d.token,a=new ic(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,i,_=>{Q(_+" ("+this.repoInfo_.toString()+")"),this.interrupt(dc)},r))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&Q(h),l())}}}interrupt(e){q("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){q("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ti(this.interruptReasons_)&&(this.reconnectDelay_=ze,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let i;n?i=n.map(r=>Hn(r)).join("$"):i="default";const s=this.removeListen_(e,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,n){const i=new N(e).toString();let s;if(this.listens.has(i)){const r=this.listens.get(i);s=r.get(n),r.delete(n),r.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(e,n){q("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Qi&&(this.reconnectDelay_=Yi,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){q("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Qi&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+Os.replace(/\./g,"-")]=1,ws()?e["framework.cordova"]=1:Vo()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Tt.getInstance().currentlyOnline();return Ti(this.interruptReasons_)&&e}}oe.nextPersistentConnectionId_=0;oe.nextConnectionId_=0;class I{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new I(e,n)}}class Bt{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const i=new I(Me,e),s=new I(Me,n);return this.compare(i,s)!==0}minPost(){return I.MIN}}let _t;class hr extends Bt{static get __EMPTY_NODE(){return _t}static set __EMPTY_NODE(e){_t=e}compare(e,n){return $e(e.name,n.name)}isDefinedOn(e){throw Be("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return I.MIN}maxPost(){return new I(Ce,_t)}makePost(e,n){return g(typeof e=="string","KeyIndex indexValue must always be a string."),new I(e,_t)}toString(){return".key"}}const Pe=new hr;class gt{constructor(e,n,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?i(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class H{constructor(e,n,i,s,r){this.key=e,this.value=n,this.color=i??H.RED,this.left=s??K.EMPTY_NODE,this.right=r??K.EMPTY_NODE}copy(e,n,i,s,r){return new H(e??this.key,n??this.value,i??this.color,s??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,i){let s=this;const r=i(e,s.key);return r<0?s=s.copy(null,null,null,s.left.insert(e,n,i),null):r===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,n,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return K.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let i,s;if(i=this,n(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),n(e,i.key)===0){if(i.right.isEmpty())return K.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,H.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,H.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}H.RED=!0;H.BLACK=!1;class uc{copy(e,n,i,s,r){return this}insert(e,n,i){return new H(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class K{constructor(e,n=K.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new K(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,H.BLACK,null,null))}remove(e){return new K(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,H.BLACK,null,null))}get(e){let n,i=this.root_;for(;!i.isEmpty();){if(n=this.comparator_(e,i.key),n===0)return i.value;n<0?i=i.left:n>0&&(i=i.right)}return null}getPredecessorKey(e){let n,i=this.root_,s=null;for(;!i.isEmpty();)if(n=this.comparator_(e,i.key),n===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else n<0?i=i.left:n>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new gt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new gt(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new gt(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new gt(this.root_,null,this.comparator_,!0,e)}}K.EMPTY_NODE=new uc;function fc(t,e){return $e(t.name,e.name)}function Gn(t,e){return $e(t,e)}let bn;function pc(t){bn=t}const dr=function(t){return typeof t=="number"?"number:"+Ws(t):"string:"+t},ur=function(t){if(t.isLeafNode()){const e=t.val();g(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ne(e,".sv"),"Priority must be a string or number.")}else g(t===bn||t.isEmpty(),"priority of unexpected type.");g(t===bn||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Xi;class ${static set __childrenNodeConstructor(e){Xi=e}static get __childrenNodeConstructor(){return Xi}constructor(e,n=$.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,g(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),ur(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new $(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:$.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return S(e)?this:E(e)===".priority"?this.priorityNode_:$.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:$.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const i=E(e);return i===null?n:n.isEmpty()&&i!==".priority"?this:(g(i!==".priority"||fe(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,$.__childrenNodeConstructor.EMPTY_NODE.updateChild(x(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+dr(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=Ws(this.value_):e+=this.value_,this.lazyHash_=$s(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===$.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof $.__childrenNodeConstructor?-1:(g(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,i=typeof this.value_,s=$.VALUE_TYPE_ORDER.indexOf(n),r=$.VALUE_TYPE_ORDER.indexOf(i);return g(s>=0,"Unknown leaf type: "+n),g(r>=0,"Unknown leaf type: "+i),s===r?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}$.VALUE_TYPE_ORDER=["object","boolean","number","string"];let fr,pr;function _c(t){fr=t}function gc(t){pr=t}class mc extends Bt{compare(e,n){const i=e.node.getPriority(),s=n.node.getPriority(),r=i.compareTo(s);return r===0?$e(e.name,n.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return I.MIN}maxPost(){return new I(Ce,new $("[PRIORITY-POST]",pr))}makePost(e,n){const i=fr(e);return new I(n,new $("[PRIORITY-POST]",i))}toString(){return".priority"}}const L=new mc;const vc=Math.log(2);class yc{constructor(e){const n=r=>parseInt(Math.log(r)/vc,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const wt=function(t,e,n,i){t.sort(e);const s=function(l,c){const u=c-l;let h,d;if(u===0)return null;if(u===1)return h=t[l],d=n?n(h):h,new H(d,h.node,H.BLACK,null,null);{const _=parseInt(u/2,10)+l,m=s(l,_),y=s(_+1,c);return h=t[_],d=n?n(h):h,new H(d,h.node,H.BLACK,m,y)}},r=function(l){let c=null,u=null,h=t.length;const d=function(m,y){const T=h-m,f=h;h-=m;const p=s(T+1,f),v=t[T],b=n?n(v):v;_(new H(b,v.node,y,null,p))},_=function(m){c?(c.left=m,c=m):(u=m,c=m)};for(let m=0;m<l.count;++m){const y=l.nextBitIsOne(),T=Math.pow(2,l.count-(m+1));y?d(T,H.BLACK):(d(T,H.BLACK),d(T,H.RED))}return u},o=new yc(t.length),a=r(o);return new K(i||e,a)};let rn;const Ne={};class re{static get Default(){return g(Ne&&L,"ChildrenNode.ts has not been loaded"),rn=rn||new re({".priority":Ne},{".priority":L}),rn}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=ye(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof K?n:null}hasIndex(e){return ne(this.indexSet_,e.toString())}addIndex(e,n){g(e!==Pe,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=n.getIterator(I.Wrap);let o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=wt(i,e.getCompare()):a=Ne;const l=e.toString(),c={...this.indexSet_};c[l]=e;const u={...this.indexes_};return u[l]=a,new re(u,c)}addToIndexes(e,n){const i=Ct(this.indexes_,(s,r)=>{const o=ye(this.indexSet_,r);if(g(o,"Missing index implementation for "+r),s===Ne)if(o.isDefinedOn(e.node)){const a=[],l=n.getIterator(I.Wrap);let c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),wt(a,o.getCompare())}else return Ne;else{const a=n.get(e.name);let l=s;return a&&(l=l.remove(new I(e.name,a))),l.insert(e,e.node)}});return new re(i,this.indexSet_)}removeFromIndexes(e,n){const i=Ct(this.indexes_,s=>{if(s===Ne)return s;{const r=n.get(e.name);return r?s.remove(new I(e.name,r)):s}});return new re(i,this.indexSet_)}}let Ue;class C{static get EMPTY_NODE(){return Ue||(Ue=new C(new K(Gn),null,re.Default))}constructor(e,n,i){this.children_=e,this.priorityNode_=n,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&ur(this.priorityNode_),this.children_.isEmpty()&&g(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ue}updatePriority(e){return this.children_.isEmpty()?this:new C(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Ue:n}}getChild(e){const n=E(e);return n===null?this:this.getImmediateChild(n).getChild(x(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(g(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const i=new I(e,n);let s,r;n.isEmpty()?(s=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(e,n),r=this.indexMap_.addToIndexes(i,this.children_));const o=s.isEmpty()?Ue:this.priorityNode_;return new C(s,o,r)}}updateChild(e,n){const i=E(e);if(i===null)return n;{g(E(e)!==".priority"||fe(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(x(e),n);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let i=0,s=0,r=!0;if(this.forEachChild(L,(o,a)=>{n[o]=a.val(e),i++,r&&C.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):r=!1}),!e&&r&&s<2*i){const o=[];for(const a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+dr(this.getPriority().val())+":"),this.forEachChild(L,(n,i)=>{const s=i.hash();s!==""&&(e+=":"+n+":"+s)}),this.lazyHash_=e===""?"":$s(e)}return this.lazyHash_}getPredecessorChildName(e,n,i){const s=this.resolveIndex_(i);if(s){const r=s.getPredecessorKey(new I(e,n));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const i=n.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new I(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const i=n.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new I(n,this.children_.get(n)):null}forEachChild(e,n){const i=this.resolveIndex_(e);return i?i.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const i=this.resolveIndex_(n);if(i)return i.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,I.Wrap);let r=s.peek();for(;r!=null&&n.compare(r,e)<0;)s.getNext(),r=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const i=this.resolveIndex_(n);if(i)return i.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,I.Wrap);let r=s.peek();for(;r!=null&&n.compare(r,e)>0;)s.getNext(),r=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ut?-1:0}withIndex(e){if(e===Pe||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new C(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===Pe||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const i=this.getIterator(L),s=n.getIterator(L);let r=i.getNext(),o=s.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=i.getNext(),o=s.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Pe?null:this.indexMap_.get(e.toString())}}C.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Cc extends C{constructor(){super(new K(Gn),C.EMPTY_NODE,re.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return C.EMPTY_NODE}isEmpty(){return!1}}const ut=new Cc;Object.defineProperties(I,{MIN:{value:new I(Me,C.EMPTY_NODE)},MAX:{value:new I(Ce,ut)}});hr.__EMPTY_NODE=C.EMPTY_NODE;$.__childrenNodeConstructor=C;pc(ut);gc(ut);const bc=!0;function U(t,e=null){if(t===null)return C.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),g(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new $(n,U(e))}if(!(t instanceof Array)&&bc){const n=[];let i=!1;if(Y(t,(o,a)=>{if(o.substring(0,1)!=="."){const l=U(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),n.push(new I(o,l)))}}),n.length===0)return C.EMPTY_NODE;const r=wt(n,fc,o=>o.name,Gn);if(i){const o=wt(n,L.getCompare());return new C(r,U(e),new re({".priority":o},{".priority":L}))}else return new C(r,U(e),re.Default)}else{let n=C.EMPTY_NODE;return Y(t,(i,s)=>{if(ne(t,i)&&i.substring(0,1)!=="."){const r=U(s);(r.isLeafNode()||!r.isEmpty())&&(n=n.updateImmediateChild(i,r))}}),n.updatePriority(U(e))}}_c(U);class Ec extends Bt{constructor(e){super(),this.indexPath_=e,g(!S(e)&&E(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const i=this.extractChild(e.node),s=this.extractChild(n.node),r=i.compareTo(s);return r===0?$e(e.name,n.name):r}makePost(e,n){const i=U(e),s=C.EMPTY_NODE.updateChild(this.indexPath_,i);return new I(n,s)}maxPost(){const e=C.EMPTY_NODE.updateChild(this.indexPath_,ut);return new I(Ce,e)}toString(){return ar(this.indexPath_,0).join("/")}}class Ic extends Bt{compare(e,n){const i=e.node.compareTo(n.node);return i===0?$e(e.name,n.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return I.MIN}maxPost(){return I.MAX}makePost(e,n){const i=U(e);return new I(n,i)}toString(){return".value"}}const Sc=new Ic;function _r(t){return{type:"value",snapshotNode:t}}function Oe(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function tt(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function nt(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function Tc(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}class jn{constructor(e){this.index_=e}updateChild(e,n,i,s,r,o){g(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(n)?o.trackChildChange(tt(n,a)):g(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Oe(n,i)):o.trackChildChange(nt(n,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(n,i).withIndex(this.index_)}updateFullNode(e,n,i){return i!=null&&(e.isLeafNode()||e.forEachChild(L,(s,r)=>{n.hasChild(s)||i.trackChildChange(tt(s,r))}),n.isLeafNode()||n.forEachChild(L,(s,r)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(nt(s,r,o))}else i.trackChildChange(Oe(s,r))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?C.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class it{constructor(e){this.indexedFilter_=new jn(e.getIndex()),this.index_=e.getIndex(),this.startPost_=it.getStartPost_(e),this.endPost_=it.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&i}updateChild(e,n,i,s,r,o){return this.matches(new I(n,i))||(i=C.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,i,s,r,o)}updateFullNode(e,n,i){n.isLeafNode()&&(n=C.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(C.EMPTY_NODE);const r=this;return n.forEachChild(L,(o,a)=>{r.matches(new I(o,a))||(s=s.updateImmediateChild(o,C.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}class wc{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=n=>{const i=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new it(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,i,s,r,o){return this.rangedFilter_.matches(new I(n,i))||(i=C.EMPTY_NODE),e.getImmediateChild(n).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,i,s,r,o):this.fullLimitUpdateChild_(e,n,i,r,o)}updateFullNode(e,n,i){let s;if(n.isLeafNode()||n.isEmpty())s=C.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=C.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(C.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){const a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,C.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,i,s,r){let o;if(this.reverse_){const h=this.index_.getCompare();o=(d,_)=>h(_,d)}else o=this.index_.getCompare();const a=e;g(a.numChildren()===this.limit_,"");const l=new I(n,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(n)){const h=a.getImmediateChild(n);let d=s.getChildAfterChild(this.index_,c,this.reverse_);for(;d!=null&&(d.name===n||a.hasChild(d.name));)d=s.getChildAfterChild(this.index_,d,this.reverse_);const _=d==null?1:o(d,l);if(u&&!i.isEmpty()&&_>=0)return r?.trackChildChange(nt(n,i,h)),a.updateImmediateChild(n,i);{r?.trackChildChange(tt(n,h));const y=a.updateImmediateChild(n,C.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(r?.trackChildChange(Oe(d.name,d.node)),y.updateImmediateChild(d.name,d.node)):y}}else return i.isEmpty()?e:u&&o(c,l)>=0?(r!=null&&(r.trackChildChange(tt(c.name,c.node)),r.trackChildChange(Oe(n,i))),a.updateImmediateChild(n,i).updateImmediateChild(c.name,C.EMPTY_NODE)):e}}class Kn{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=L}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return g(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return g(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Me}hasEnd(){return this.endSet_}getIndexEndValue(){return g(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return g(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ce}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return g(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===L}copy(){const e=new Kn;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function kc(t){return t.loadsAllData()?new jn(t.getIndex()):t.hasLimit()?new wc(t):new it(t)}function Ji(t){const e={};if(t.isDefault())return e;let n;if(t.index_===L?n="$priority":t.index_===Sc?n="$value":t.index_===Pe?n="$key":(g(t.index_ instanceof Ec,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=W(n),t.startSet_){const i=t.startAfterSet_?"startAfter":"startAt";e[i]=W(t.indexStartValue_),t.startNameSet_&&(e[i]+=","+W(t.indexStartName_))}if(t.endSet_){const i=t.endBeforeSet_?"endBefore":"endAt";e[i]=W(t.indexEndValue_),t.endNameSet_&&(e[i]+=","+W(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Zi(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==L&&(e.i=t.index_.toString()),e}class kt extends sr{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(g(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=ht("p:rest:"),this.listens_={}}listen(e,n,i,s){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=kt.getListenId_(e,i),a={};this.listens_[o]=a;const l=Ji(e._queryParams);this.restRequest_(r+".json",l,(c,u)=>{let h=u;if(c===404&&(h=null,c=null),c===null&&this.onDataUpdate_(r,h,!1,i),ye(this.listens_,o)===a){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",s(d,null)}})}unlisten(e,n){const i=kt.getListenId_(e,n);delete this.listens_[i]}get(e){const n=Ji(e._queryParams),i=e._path.toString(),s=new Ot;return this.restRequest_(i+".json",n,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},i){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(n.auth=s.accessToken),r&&r.token&&(n.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Zo(n);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Xe(a.responseText)}catch{Q("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&Q("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}class Nc{constructor(){this.rootNode_=C.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}function Nt(){return{value:null,children:new Map}}function gr(t,e,n){if(S(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const i=E(e);t.children.has(i)||t.children.set(i,Nt());const s=t.children.get(i);e=x(e),gr(s,e,n)}}function En(t,e,n){t.value!==null?n(e,t.value):Ac(t,(i,s)=>{const r=new N(e.toString()+"/"+i);En(s,r,n)})}function Ac(t,e){t.children.forEach((n,i)=>{e(i,n)})}class Rc{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&Y(this.last_,(i,s)=>{n[i]=n[i]-s}),this.last_=e,n}}const es=10*1e3,xc=30*1e3,Dc=300*1e3;class Pc{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new Rc(e);const i=es+(xc-es)*Math.random();je(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),n={};let i=!1;Y(e,(s,r)=>{r>0&&ne(this.statsToReport_,s)&&(n[s]=r,i=!0)}),i&&this.server_.reportStats(n),je(this.reportStats_.bind(this),Math.floor(Math.random()*2*Dc))}}var ee;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(ee||(ee={}));function mr(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Yn(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Qn(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}class At{constructor(e,n,i){this.path=e,this.affectedTree=n,this.revert=i,this.type=ee.ACK_USER_WRITE,this.source=mr()}operationForChild(e){if(S(this.path)){if(this.affectedTree.value!=null)return g(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new N(e));return new At(k(),n,this.revert)}}else return g(E(this.path)===e,"operationForChild called for unrelated child."),new At(x(this.path),this.affectedTree,this.revert)}}class st{constructor(e,n){this.source=e,this.path=n,this.type=ee.LISTEN_COMPLETE}operationForChild(e){return S(this.path)?new st(this.source,k()):new st(this.source,x(this.path))}}class be{constructor(e,n,i){this.source=e,this.path=n,this.snap=i,this.type=ee.OVERWRITE}operationForChild(e){return S(this.path)?new be(this.source,k(),this.snap.getImmediateChild(e)):new be(this.source,x(this.path),this.snap)}}class rt{constructor(e,n,i){this.source=e,this.path=n,this.children=i,this.type=ee.MERGE}operationForChild(e){if(S(this.path)){const n=this.children.subtree(new N(e));return n.isEmpty()?null:n.value?new be(this.source,k(),n.value):new rt(this.source,k(),n)}else return g(E(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new rt(this.source,x(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Ee{constructor(e,n,i){this.node_=e,this.fullyInitialized_=n,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(S(e))return this.isFullyInitialized()&&!this.filtered_;const n=E(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Lc{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Mc(t,e,n,i){const s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(Tc(o.childName,o.snapshotNode))}),Ve(t,s,"child_removed",e,i,n),Ve(t,s,"child_added",e,i,n),Ve(t,s,"child_moved",r,i,n),Ve(t,s,"child_changed",e,i,n),Ve(t,s,"value",e,i,n),s}function Ve(t,e,n,i,s,r){const o=i.filter(a=>a.type===n);o.sort((a,l)=>Fc(t,a,l)),o.forEach(a=>{const l=Oc(t,a,r);s.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,t.query_))})})}function Oc(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function Fc(t,e,n){if(e.childName==null||n.childName==null)throw Be("Should only compare child_ events.");const i=new I(e.childName,e.snapshotNode),s=new I(n.childName,n.snapshotNode);return t.index_.compare(i,s)}function $t(t,e){return{eventCache:t,serverCache:e}}function Ke(t,e,n,i){return $t(new Ee(e,n,i),t.serverCache)}function vr(t,e,n,i){return $t(t.eventCache,new Ee(e,n,i))}function In(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Ie(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}let on;const Bc=()=>(on||(on=new K(Il)),on);class D{static fromObject(e){let n=new D(null);return Y(e,(i,s)=>{n=n.set(new N(i),s)}),n}constructor(e,n=Bc()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:k(),value:this.value};if(S(e))return null;{const i=E(e),s=this.children.get(i);if(s!==null){const r=s.findRootMostMatchingPathAndValue(x(e),n);return r!=null?{path:F(new N(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(S(e))return this;{const n=E(e),i=this.children.get(n);return i!==null?i.subtree(x(e)):new D(null)}}set(e,n){if(S(e))return new D(n,this.children);{const i=E(e),r=(this.children.get(i)||new D(null)).set(x(e),n),o=this.children.insert(i,r);return new D(this.value,o)}}remove(e){if(S(e))return this.children.isEmpty()?new D(null):new D(null,this.children);{const n=E(e),i=this.children.get(n);if(i){const s=i.remove(x(e));let r;return s.isEmpty()?r=this.children.remove(n):r=this.children.insert(n,s),this.value===null&&r.isEmpty()?new D(null):new D(this.value,r)}else return this}}get(e){if(S(e))return this.value;{const n=E(e),i=this.children.get(n);return i?i.get(x(e)):null}}setTree(e,n){if(S(e))return n;{const i=E(e),r=(this.children.get(i)||new D(null)).setTree(x(e),n);let o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new D(this.value,o)}}fold(e){return this.fold_(k(),e)}fold_(e,n){const i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(F(e,s),n)}),n(e,this.value,i)}findOnPath(e,n){return this.findOnPath_(e,k(),n)}findOnPath_(e,n,i){const s=this.value?i(n,this.value):!1;if(s)return s;if(S(e))return null;{const r=E(e),o=this.children.get(r);return o?o.findOnPath_(x(e),F(n,r),i):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,k(),n)}foreachOnPath_(e,n,i){if(S(e))return this;{this.value&&i(n,this.value);const s=E(e),r=this.children.get(s);return r?r.foreachOnPath_(x(e),F(n,s),i):new D(null)}}foreach(e){this.foreach_(k(),e)}foreach_(e,n){this.children.inorderTraversal((i,s)=>{s.foreach_(F(e,i),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,i)=>{i.value&&e(n,i.value)})}}class te{constructor(e){this.writeTree_=e}static empty(){return new te(new D(null))}}function Ye(t,e,n){if(S(e))return new te(new D(n));{const i=t.writeTree_.findRootMostValueAndPath(e);if(i!=null){const s=i.path;let r=i.value;const o=j(s,e);return r=r.updateChild(o,n),new te(t.writeTree_.set(s,r))}else{const s=new D(n),r=t.writeTree_.setTree(e,s);return new te(r)}}}function ts(t,e,n){let i=t;return Y(n,(s,r)=>{i=Ye(i,F(e,s),r)}),i}function ns(t,e){if(S(e))return te.empty();{const n=t.writeTree_.setTree(e,new D(null));return new te(n)}}function Sn(t,e){return Se(t,e)!=null}function Se(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(j(n.path,e)):null}function is(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(L,(i,s)=>{e.push(new I(i,s))}):t.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new I(i,s.value))}),e}function ue(t,e){if(S(e))return t;{const n=Se(t,e);return n!=null?new te(new D(n)):new te(t.writeTree_.subtree(e))}}function Tn(t){return t.writeTree_.isEmpty()}function Fe(t,e){return yr(k(),t.writeTree_,e)}function yr(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(g(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):n=yr(F(t,s),r,n)}),!n.getChild(t).isEmpty()&&i!==null&&(n=n.updateChild(F(t,".priority"),i)),n}}function Xn(t,e){return Ir(e,t)}function $c(t,e,n,i,s){g(i>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:i,visible:s}),s&&(t.visibleWrites=Ye(t.visibleWrites,e,n)),t.lastWriteId=i}function Hc(t,e){for(let n=0;n<t.allWrites.length;n++){const i=t.allWrites[n];if(i.writeId===e)return i}return null}function Wc(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);g(n>=0,"removeWrite called with nonexistent writeId.");const i=t.allWrites[n];t.allWrites.splice(n,1);let s=i.visible,r=!1,o=t.allWrites.length-1;for(;s&&o>=0;){const a=t.allWrites[o];a.visible&&(o>=n&&zc(a,i.path)?s=!1:Z(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return Uc(t),!0;if(i.snap)t.visibleWrites=ns(t.visibleWrites,i.path);else{const a=i.children;Y(a,l=>{t.visibleWrites=ns(t.visibleWrites,F(i.path,l))})}return!0}else return!1}function zc(t,e){if(t.snap)return Z(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Z(F(t.path,n),e))return!0;return!1}function Uc(t){t.visibleWrites=Cr(t.allWrites,Vc,k()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function Vc(t){return t.visible}function Cr(t,e,n){let i=te.empty();for(let s=0;s<t.length;++s){const r=t[s];if(e(r)){const o=r.path;let a;if(r.snap)Z(n,o)?(a=j(n,o),i=Ye(i,a,r.snap)):Z(o,n)&&(a=j(o,n),i=Ye(i,k(),r.snap.getChild(a)));else if(r.children){if(Z(n,o))a=j(n,o),i=ts(i,a,r.children);else if(Z(o,n))if(a=j(o,n),S(a))i=ts(i,k(),r.children);else{const l=ye(r.children,E(a));if(l){const c=l.getChild(x(a));i=Ye(i,k(),c)}}}else throw Be("WriteRecord should have .snap or .children")}}return i}function br(t,e,n,i,s){if(!i&&!s){const r=Se(t.visibleWrites,e);if(r!=null)return r;{const o=ue(t.visibleWrites,e);if(Tn(o))return n;if(n==null&&!Sn(o,k()))return null;{const a=n||C.EMPTY_NODE;return Fe(o,a)}}}else{const r=ue(t.visibleWrites,e);if(!s&&Tn(r))return n;if(!s&&n==null&&!Sn(r,k()))return null;{const o=function(c){return(c.visible||s)&&(!i||!~i.indexOf(c.writeId))&&(Z(c.path,e)||Z(e,c.path))},a=Cr(t.allWrites,o,e),l=n||C.EMPTY_NODE;return Fe(a,l)}}}function qc(t,e,n){let i=C.EMPTY_NODE;const s=Se(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(L,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(n){const r=ue(t.visibleWrites,e);return n.forEachChild(L,(o,a)=>{const l=Fe(ue(r,new N(o)),a);i=i.updateImmediateChild(o,l)}),is(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{const r=ue(t.visibleWrites,e);return is(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function Gc(t,e,n,i,s){g(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=F(e,n);if(Sn(t.visibleWrites,r))return null;{const o=ue(t.visibleWrites,r);return Tn(o)?s.getChild(n):Fe(o,s.getChild(n))}}function jc(t,e,n,i){const s=F(e,n),r=Se(t.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(n)){const o=ue(t.visibleWrites,s);return Fe(o,i.getNode().getImmediateChild(n))}else return null}function Kc(t,e){return Se(t.visibleWrites,e)}function Yc(t,e,n,i,s,r,o){let a;const l=ue(t.visibleWrites,e),c=Se(l,k());if(c!=null)a=c;else if(n!=null)a=Fe(l,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const u=[],h=o.getCompare(),d=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let _=d.getNext();for(;_&&u.length<s;)h(_,i)!==0&&u.push(_),_=d.getNext();return u}else return[]}function Qc(){return{visibleWrites:te.empty(),allWrites:[],lastWriteId:-1}}function Rt(t,e,n,i){return br(t.writeTree,t.treePath,e,n,i)}function Jn(t,e){return qc(t.writeTree,t.treePath,e)}function ss(t,e,n,i){return Gc(t.writeTree,t.treePath,e,n,i)}function xt(t,e){return Kc(t.writeTree,F(t.treePath,e))}function Xc(t,e,n,i,s,r){return Yc(t.writeTree,t.treePath,e,n,i,s,r)}function Zn(t,e,n){return jc(t.writeTree,t.treePath,e,n)}function Er(t,e){return Ir(F(t.treePath,e),t.writeTree)}function Ir(t,e){return{treePath:t,writeTree:e}}class Jc{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,i=e.childName;g(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),g(i!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const r=s.type;if(n==="child_added"&&r==="child_removed")this.changeMap.set(i,nt(i,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(n==="child_removed"&&r==="child_changed")this.changeMap.set(i,tt(i,s.oldSnap));else if(n==="child_changed"&&r==="child_added")this.changeMap.set(i,Oe(i,e.snapshotNode));else if(n==="child_changed"&&r==="child_changed")this.changeMap.set(i,nt(i,e.snapshotNode,s.oldSnap));else throw Be("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}class Zc{getCompleteChild(e){return null}getChildAfterChild(e,n,i){return null}}const Sr=new Zc;class ei{constructor(e,n,i=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=i}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new Ee(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Zn(this.writes_,e,i)}}getChildAfterChild(e,n,i){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ie(this.viewCache_),r=Xc(this.writes_,s,n,1,i,e);return r.length===0?null:r[0]}}function eh(t){return{filter:t}}function th(t,e){g(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),g(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function nh(t,e,n,i,s){const r=new Jc;let o,a;if(n.type===ee.OVERWRITE){const c=n;c.source.fromUser?o=wn(t,e,c.path,c.snap,i,s,r):(g(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!S(c.path),o=Dt(t,e,c.path,c.snap,i,s,a,r))}else if(n.type===ee.MERGE){const c=n;c.source.fromUser?o=sh(t,e,c.path,c.children,i,s,r):(g(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=kn(t,e,c.path,c.children,i,s,a,r))}else if(n.type===ee.ACK_USER_WRITE){const c=n;c.revert?o=ah(t,e,c.path,i,s,r):o=rh(t,e,c.path,c.affectedTree,i,s,r)}else if(n.type===ee.LISTEN_COMPLETE)o=oh(t,e,n.path,i,r);else throw Be("Unknown operation type: "+n.type);const l=r.getChanges();return ih(e,o,l),{viewCache:o,changes:l}}function ih(t,e,n){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=In(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push(_r(In(e)))}}function Tr(t,e,n,i,s,r){const o=e.eventCache;if(xt(i,n)!=null)return e;{let a,l;if(S(n))if(g(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=Ie(e),u=c instanceof C?c:C.EMPTY_NODE,h=Jn(i,u);a=t.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const c=Rt(i,Ie(e));a=t.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{const c=E(n);if(c===".priority"){g(fe(n)===1,"Can't have a priority with additional path components");const u=o.getNode();l=e.serverCache.getNode();const h=ss(i,n,u,l);h!=null?a=t.filter.updatePriority(u,h):a=o.getNode()}else{const u=x(n);let h;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();const d=ss(i,n,o.getNode(),l);d!=null?h=o.getNode().getImmediateChild(c).updateChild(u,d):h=o.getNode().getImmediateChild(c)}else h=Zn(i,c,e.serverCache);h!=null?a=t.filter.updateChild(o.getNode(),c,h,u,s,r):a=o.getNode()}}return Ke(e,a,o.isFullyInitialized()||S(n),t.filter.filtersNodes())}}function Dt(t,e,n,i,s,r,o,a){const l=e.serverCache;let c;const u=o?t.filter:t.filter.getIndexedFilter();if(S(n))c=u.updateFullNode(l.getNode(),i,null);else if(u.filtersNodes()&&!l.isFiltered()){const _=l.getNode().updateChild(n,i);c=u.updateFullNode(l.getNode(),_,null)}else{const _=E(n);if(!l.isCompleteForPath(n)&&fe(n)>1)return e;const m=x(n),T=l.getNode().getImmediateChild(_).updateChild(m,i);_===".priority"?c=u.updatePriority(l.getNode(),T):c=u.updateChild(l.getNode(),_,T,m,Sr,null)}const h=vr(e,c,l.isFullyInitialized()||S(n),u.filtersNodes()),d=new ei(s,h,r);return Tr(t,h,n,s,d,a)}function wn(t,e,n,i,s,r,o){const a=e.eventCache;let l,c;const u=new ei(s,e,r);if(S(n))c=t.filter.updateFullNode(e.eventCache.getNode(),i,o),l=Ke(e,c,!0,t.filter.filtersNodes());else{const h=E(n);if(h===".priority")c=t.filter.updatePriority(e.eventCache.getNode(),i),l=Ke(e,c,a.isFullyInitialized(),a.isFiltered());else{const d=x(n),_=a.getNode().getImmediateChild(h);let m;if(S(d))m=i;else{const y=u.getCompleteChild(h);y!=null?or(d)===".priority"&&y.getChild(lr(d)).isEmpty()?m=y:m=y.updateChild(d,i):m=C.EMPTY_NODE}if(_.equals(m))l=e;else{const y=t.filter.updateChild(a.getNode(),h,m,d,u,o);l=Ke(e,y,a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function rs(t,e){return t.eventCache.isCompleteForChild(e)}function sh(t,e,n,i,s,r,o){let a=e;return i.foreach((l,c)=>{const u=F(n,l);rs(e,E(u))&&(a=wn(t,a,u,c,s,r,o))}),i.foreach((l,c)=>{const u=F(n,l);rs(e,E(u))||(a=wn(t,a,u,c,s,r,o))}),a}function os(t,e,n){return n.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function kn(t,e,n,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;S(n)?c=i:c=new D(null).setTree(n,i);const u=e.serverCache.getNode();return c.children.inorderTraversal((h,d)=>{if(u.hasChild(h)){const _=e.serverCache.getNode().getImmediateChild(h),m=os(t,_,d);l=Dt(t,l,new N(h),m,s,r,o,a)}}),c.children.inorderTraversal((h,d)=>{const _=!e.serverCache.isCompleteForChild(h)&&d.value===null;if(!u.hasChild(h)&&!_){const m=e.serverCache.getNode().getImmediateChild(h),y=os(t,m,d);l=Dt(t,l,new N(h),y,s,r,o,a)}}),l}function rh(t,e,n,i,s,r,o){if(xt(s,n)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(i.value!=null){if(S(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return Dt(t,e,n,l.getNode().getChild(n),s,r,a,o);if(S(n)){let c=new D(null);return l.getNode().forEachChild(Pe,(u,h)=>{c=c.set(new N(u),h)}),kn(t,e,n,c,s,r,a,o)}else return e}else{let c=new D(null);return i.foreach((u,h)=>{const d=F(n,u);l.isCompleteForPath(d)&&(c=c.set(u,l.getNode().getChild(d)))}),kn(t,e,n,c,s,r,a,o)}}function oh(t,e,n,i,s){const r=e.serverCache,o=vr(e,r.getNode(),r.isFullyInitialized()||S(n),r.isFiltered());return Tr(t,o,n,i,Sr,s)}function ah(t,e,n,i,s,r){let o;if(xt(i,n)!=null)return e;{const a=new ei(i,e,s),l=e.eventCache.getNode();let c;if(S(n)||E(n)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Rt(i,Ie(e));else{const h=e.serverCache.getNode();g(h instanceof C,"serverChildren would be complete if leaf node"),u=Jn(i,h)}u=u,c=t.filter.updateFullNode(l,u,r)}else{const u=E(n);let h=Zn(i,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=l.getImmediateChild(u)),h!=null?c=t.filter.updateChild(l,u,h,x(n),a,r):e.eventCache.getNode().hasChild(u)?c=t.filter.updateChild(l,u,C.EMPTY_NODE,x(n),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Rt(i,Ie(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||xt(i,k())!=null,Ke(e,c,o,t.filter.filtersNodes())}}class lh{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new jn(i.getIndex()),r=kc(i);this.processor_=eh(r);const o=n.serverCache,a=n.eventCache,l=s.updateFullNode(C.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(C.EMPTY_NODE,a.getNode(),null),u=new Ee(l,o.isFullyInitialized(),s.filtersNodes()),h=new Ee(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=$t(h,u),this.eventGenerator_=new Lc(this.query_)}get query(){return this.query_}}function ch(t){return t.viewCache_.serverCache.getNode()}function hh(t,e){const n=Ie(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!S(e)&&!n.getImmediateChild(E(e)).isEmpty())?n.getChild(e):null}function as(t){return t.eventRegistrations_.length===0}function dh(t,e){t.eventRegistrations_.push(e)}function ls(t,e,n){const i=[];if(n){g(e==null,"A cancel should cancel all event registrations.");const s=t.query._path;t.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(n,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<t.eventRegistrations_.length;++r){const o=t.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(r+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return i}function cs(t,e,n,i){e.type===ee.MERGE&&e.source.queryId!==null&&(g(Ie(t.viewCache_),"We should always have a full cache before handling merges"),g(In(t.viewCache_),"Missing event cache, even though we have a server cache"));const s=t.viewCache_,r=nh(t.processor_,s,e,n,i);return th(t.processor_,r.viewCache),g(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,wr(t,r.changes,r.viewCache.eventCache.getNode(),null)}function uh(t,e){const n=t.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(L,(r,o)=>{i.push(Oe(r,o))}),n.isFullyInitialized()&&i.push(_r(n.getNode())),wr(t,i,n.getNode(),e)}function wr(t,e,n,i){const s=i?[i]:t.eventRegistrations_;return Mc(t.eventGenerator_,e,n,s)}let Pt;class fh{constructor(){this.views=new Map}}function ph(t){g(!Pt,"__referenceConstructor has already been defined"),Pt=t}function _h(){return g(Pt,"Reference.ts has not been loaded"),Pt}function gh(t){return t.views.size===0}function ti(t,e,n,i){const s=e.source.queryId;if(s!==null){const r=t.views.get(s);return g(r!=null,"SyncTree gave us an op for an invalid query."),cs(r,e,n,i)}else{let r=[];for(const o of t.views.values())r=r.concat(cs(o,e,n,i));return r}}function mh(t,e,n,i,s){const r=e._queryIdentifier,o=t.views.get(r);if(!o){let a=Rt(n,s?i:null),l=!1;a?l=!0:i instanceof C?(a=Jn(n,i),l=!1):(a=C.EMPTY_NODE,l=!1);const c=$t(new Ee(a,l,!1),new Ee(i,s,!1));return new lh(e,c)}return o}function vh(t,e,n,i,s,r){const o=mh(t,e,i,s,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),dh(o,n),uh(o,n)}function yh(t,e,n,i){const s=e._queryIdentifier,r=[];let o=[];const a=pe(t);if(s==="default")for(const[l,c]of t.views.entries())o=o.concat(ls(c,n,i)),as(c)&&(t.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{const l=t.views.get(s);l&&(o=o.concat(ls(l,n,i)),as(l)&&(t.views.delete(s),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!pe(t)&&r.push(new(_h())(e._repo,e._path)),{removed:r,events:o}}function kr(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Le(t,e){let n=null;for(const i of t.views.values())n=n||hh(i,e);return n}function Nr(t,e){if(e._queryParams.loadsAllData())return Ht(t);{const i=e._queryIdentifier;return t.views.get(i)}}function Ar(t,e){return Nr(t,e)!=null}function pe(t){return Ht(t)!=null}function Ht(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Lt;function Ch(t){g(!Lt,"__referenceConstructor has already been defined"),Lt=t}function bh(){return g(Lt,"Reference.ts has not been loaded"),Lt}let Eh=1;class hs{constructor(e){this.listenProvider_=e,this.syncPointTree_=new D(null),this.pendingWriteTree_=Qc(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Rr(t,e,n,i,s){return $c(t.pendingWriteTree_,e,n,i,s),s?ft(t,new be(mr(),e,n)):[]}function Re(t,e,n=!1){const i=Hc(t.pendingWriteTree_,e);if(Wc(t.pendingWriteTree_,e)){let r=new D(null);return i.snap!=null?r=r.set(k(),!0):Y(i.children,o=>{r=r.set(new N(o),!0)}),ft(t,new At(i.path,r,n))}else return[]}function Wt(t,e,n){return ft(t,new be(Yn(),e,n))}function Ih(t,e,n){const i=D.fromObject(n);return ft(t,new rt(Yn(),e,i))}function Sh(t,e){return ft(t,new st(Yn(),e))}function Th(t,e,n){const i=ii(t,n);if(i){const s=si(i),r=s.path,o=s.queryId,a=j(r,e),l=new st(Qn(o),a);return ri(t,r,l)}else return[]}function Nn(t,e,n,i,s=!1){const r=e._path,o=t.syncPointTree_.get(r);let a=[];if(o&&(e._queryIdentifier==="default"||Ar(o,e))){const l=yh(o,e,n,i);gh(o)&&(t.syncPointTree_=t.syncPointTree_.remove(r));const c=l.removed;if(a=l.events,!s){const u=c.findIndex(d=>d._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(r,(d,_)=>pe(_));if(u&&!h){const d=t.syncPointTree_.subtree(r);if(!d.isEmpty()){const _=Nh(d);for(let m=0;m<_.length;++m){const y=_[m],T=y.query,f=Pr(t,y);t.listenProvider_.startListening(Qe(T),Mt(t,T),f.hashFn,f.onComplete)}}}!h&&c.length>0&&!i&&(u?t.listenProvider_.stopListening(Qe(e),null):c.forEach(d=>{const _=t.queryToTagMap.get(zt(d));t.listenProvider_.stopListening(Qe(d),_)}))}Ah(t,c)}return a}function wh(t,e,n,i){const s=ii(t,i);if(s!=null){const r=si(s),o=r.path,a=r.queryId,l=j(o,e),c=new be(Qn(a),l,n);return ri(t,o,c)}else return[]}function kh(t,e,n,i){const s=ii(t,i);if(s){const r=si(s),o=r.path,a=r.queryId,l=j(o,e),c=D.fromObject(n),u=new rt(Qn(a),l,c);return ri(t,o,u)}else return[]}function ds(t,e,n,i=!1){const s=e._path;let r=null,o=!1;t.syncPointTree_.foreachOnPath(s,(d,_)=>{const m=j(d,s);r=r||Le(_,m),o=o||pe(_)});let a=t.syncPointTree_.get(s);a?(o=o||pe(a),r=r||Le(a,k())):(a=new fh,t.syncPointTree_=t.syncPointTree_.set(s,a));let l;r!=null?l=!0:(l=!1,r=C.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((_,m)=>{const y=Le(m,k());y&&(r=r.updateImmediateChild(_,y))}));const c=Ar(a,e);if(!c&&!e._queryParams.loadsAllData()){const d=zt(e);g(!t.queryToTagMap.has(d),"View does not exist, but we have a tag");const _=Rh();t.queryToTagMap.set(d,_),t.tagToQueryMap.set(_,d)}const u=Xn(t.pendingWriteTree_,s);let h=vh(a,e,n,u,r,l);if(!c&&!o&&!i){const d=Nr(a,e);h=h.concat(xh(t,e,d))}return h}function ni(t,e,n){const s=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,(o,a)=>{const l=j(o,e),c=Le(a,l);if(c)return c});return br(s,e,r,n,!0)}function ft(t,e){return xr(e,t.syncPointTree_,null,Xn(t.pendingWriteTree_,k()))}function xr(t,e,n,i){if(S(t.path))return Dr(t,e,n,i);{const s=e.get(k());n==null&&s!=null&&(n=Le(s,k()));let r=[];const o=E(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){const c=n?n.getImmediateChild(o):null,u=Er(i,o);r=r.concat(xr(a,l,c,u))}return s&&(r=r.concat(ti(s,t,i,n))),r}}function Dr(t,e,n,i){const s=e.get(k());n==null&&s!=null&&(n=Le(s,k()));let r=[];return e.children.inorderTraversal((o,a)=>{const l=n?n.getImmediateChild(o):null,c=Er(i,o),u=t.operationForChild(o);u&&(r=r.concat(Dr(u,a,l,c)))}),s&&(r=r.concat(ti(s,t,i,n))),r}function Pr(t,e){const n=e.query,i=Mt(t,n);return{hashFn:()=>(ch(e)||C.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?Th(t,n._path,i):Sh(t,n._path);{const r=wl(s,n);return Nn(t,n,null,r)}}}}function Mt(t,e){const n=zt(e);return t.queryToTagMap.get(n)}function zt(t){return t._path.toString()+"$"+t._queryIdentifier}function ii(t,e){return t.tagToQueryMap.get(e)}function si(t){const e=t.indexOf("$");return g(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new N(t.substr(0,e))}}function ri(t,e,n){const i=t.syncPointTree_.get(e);g(i,"Missing sync point for query tag that we're tracking");const s=Xn(t.pendingWriteTree_,e);return ti(i,n,s,null)}function Nh(t){return t.fold((e,n,i)=>{if(n&&pe(n))return[Ht(n)];{let s=[];return n&&(s=kr(n)),Y(i,(r,o)=>{s=s.concat(o)}),s}})}function Qe(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(bh())(t._repo,t._path):t}function Ah(t,e){for(let n=0;n<e.length;++n){const i=e[n];if(!i._queryParams.loadsAllData()){const s=zt(i),r=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(r)}}}function Rh(){return Eh++}function xh(t,e,n){const i=e._path,s=Mt(t,e),r=Pr(t,n),o=t.listenProvider_.startListening(Qe(e),s,r.hashFn,r.onComplete),a=t.syncPointTree_.subtree(i);if(s)g(!pe(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((c,u,h)=>{if(!S(c)&&u&&pe(u))return[Ht(u).query];{let d=[];return u&&(d=d.concat(kr(u).map(_=>_.query))),Y(h,(_,m)=>{d=d.concat(m)}),d}});for(let c=0;c<l.length;++c){const u=l[c];t.listenProvider_.stopListening(Qe(u),Mt(t,u))}}return o}class oi{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new oi(n)}node(){return this.node_}}class ai{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=F(this.path_,e);return new ai(this.syncTree_,n)}node(){return ni(this.syncTree_,this.path_)}}const Dh=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},us=function(t,e,n){if(!t||typeof t!="object")return t;if(g(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return Ph(t[".sv"],e,n);if(typeof t[".sv"]=="object")return Lh(t[".sv"],e);g(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},Ph=function(t,e,n){if(t==="timestamp")return n.timestamp;g(!1,"Unexpected server value: "+t)},Lh=function(t,e,n){t.hasOwnProperty("increment")||g(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const i=t.increment;typeof i!="number"&&g(!1,"Unexpected increment value: "+i);const s=e.node();if(g(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return typeof o!="number"?i:o+i},Mh=function(t,e,n,i){return li(e,new ai(n,t),i)},Lr=function(t,e,n){return li(t,new oi(e),n)};function li(t,e,n){const i=t.getPriority().val(),s=us(i,e.getImmediateChild(".priority"),n);let r;if(t.isLeafNode()){const o=t,a=us(o.getValue(),e,n);return a!==o.getValue()||s!==o.getPriority().val()?new $(a,U(s)):t}else{const o=t;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new $(s))),o.forEachChild(L,(a,l)=>{const c=li(l,e.getImmediateChild(a),n);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}class ci{constructor(e="",n=null,i={children:{},childCount:0}){this.name=e,this.parent=n,this.node=i}}function Ut(t,e){let n=e instanceof N?e:new N(e),i=t,s=E(n);for(;s!==null;){const r=ye(i.node.children,s)||{children:{},childCount:0};i=new ci(s,i,r),n=x(n),s=E(n)}return i}function Te(t){return t.node.value}function hi(t,e){t.node.value=e,An(t)}function Mr(t){return t.node.childCount>0}function Oh(t){return Te(t)===void 0&&!Mr(t)}function Vt(t,e){Y(t.node.children,(n,i)=>{e(new ci(n,t,i))})}function Or(t,e,n,i){n&&e(t),Vt(t,s=>{Or(s,e,!0)})}function Fh(t,e,n){let i=t.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function pt(t){return new N(t.parent===null?t.name:pt(t.parent)+"/"+t.name)}function An(t){t.parent!==null&&Bh(t.parent,t.name,t)}function Bh(t,e,n){const i=Oh(n),s=ne(t.node.children,e);i&&s?(delete t.node.children[e],t.node.childCount--,An(t)):!i&&!s&&(t.node.children[e]=n.node,t.node.childCount++,An(t))}const $h=/[\[\].#$\/\u0000-\u001F\u007F]/,Hh=/[\[\].#$\u0000-\u001F\u007F]/,an=10*1024*1024,Fr=function(t){return typeof t=="string"&&t.length!==0&&!$h.test(t)},Br=function(t){return typeof t=="string"&&t.length!==0&&!Hh.test(t)},Wh=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Br(t)},zh=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!$n(t)||t&&typeof t=="object"&&ne(t,".sv")},di=function(t,e,n){const i=n instanceof N?new rc(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+me(i));if(typeof e=="function")throw new Error(t+"contains a function "+me(i)+" with contents = "+e.toString());if($n(e))throw new Error(t+"contains "+e.toString()+" "+me(i));if(typeof e=="string"&&e.length>an/3&&Ft(e)>an)throw new Error(t+"contains a string greater than "+an+" utf8 bytes "+me(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(Y(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Fr(o)))throw new Error(t+" contains an invalid key ("+o+") "+me(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);oc(i,o),di(t,a,i),ac(i)}),s&&r)throw new Error(t+' contains ".value" child '+me(i)+" in addition to actual children.")}},$r=function(t,e,n,i){if(!Br(n))throw new Error(As(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Uh=function(t,e,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),$r(t,e,n)},Vh=function(t,e){if(E(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},qh=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Fr(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!Wh(n))throw new Error(As(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class Gh{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Hr(t,e){let n=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();n!==null&&!Vn(r,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:r}),n.events.push(s)}n&&t.eventLists_.push(n)}function Wr(t,e,n){Hr(t,n),zr(t,i=>Vn(i,e))}function _e(t,e,n){Hr(t,n),zr(t,i=>Z(i,e)||Z(e,i))}function zr(t,e){t.recursionDepth_++;let n=!0;for(let i=0;i<t.eventLists_.length;i++){const s=t.eventLists_[i];if(s){const r=s.path;e(r)?(jh(t.eventLists_[i]),t.eventLists_[i]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function jh(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const i=n.getEventRunner();Ge&&q("event: "+n.toString()),dt(i)}}}const Kh="repo_interrupt",Yh=25;class Qh{constructor(e,n,i,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Gh,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Nt(),this.transactionQueueTree_=new ci,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Xh(t,e,n){if(t.stats_=zn(t.repoInfo_),t.forceRestClient_||Rl())t.server_=new kt(t.repoInfo_,(i,s,r,o)=>{fs(t,i,s,r,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>ps(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{W(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}t.persistentConnection_=new oe(t.repoInfo_,e,(i,s,r,o)=>{fs(t,i,s,r,o)},i=>{ps(t,i)},i=>{Zh(t,i)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(i=>{t.server_.refreshAuthToken(i)}),t.appCheckProvider_.addTokenChangeListener(i=>{t.server_.refreshAppCheckToken(i.token)}),t.statsReporter_=Ml(t.repoInfo_,()=>new Pc(t.stats_,t.server_)),t.infoData_=new Nc,t.infoSyncTree_=new hs({startListening:(i,s,r,o)=>{let a=[];const l=t.infoData_.getNode(i._path);return l.isEmpty()||(a=Wt(t.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),fi(t,"connected",!1),t.serverSyncTree_=new hs({startListening:(i,s,r,o)=>(t.server_.listen(i,r,s,(a,l)=>{const c=o(a,l);_e(t.eventQueue_,i._path,c)}),[]),stopListening:(i,s)=>{t.server_.unlisten(i,s)}})}function Jh(t){const n=t.infoData_.getNode(new N(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function ui(t){return Dh({timestamp:Jh(t)})}function fs(t,e,n,i,s){t.dataUpdateCount++;const r=new N(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(i){const l=Ct(n,c=>U(c));o=kh(t.serverSyncTree_,r,l,s)}else{const l=U(n);o=wh(t.serverSyncTree_,r,l,s)}else if(i){const l=Ct(n,c=>U(c));o=Ih(t.serverSyncTree_,r,l)}else{const l=U(n);o=Wt(t.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=gi(t,r)),_e(t.eventQueue_,a,o)}function ps(t,e){fi(t,"connected",e),e===!1&&ed(t)}function Zh(t,e){Y(e,(n,i)=>{fi(t,n,i)})}function fi(t,e,n){const i=new N("/.info/"+e),s=U(n);t.infoData_.updateSnapshot(i,s);const r=Wt(t.infoSyncTree_,i,s);_e(t.eventQueue_,i,r)}function Ur(t){return t.nextWriteId_++}function ed(t){pi(t,"onDisconnectEvents");const e=ui(t),n=Nt();En(t.onDisconnect_,k(),(s,r)=>{const o=Mh(s,r,t.serverSyncTree_,e);gr(n,s,o)});let i=[];En(n,k(),(s,r)=>{i=i.concat(Wt(t.serverSyncTree_,s,r));const o=ad(t,s);gi(t,o)}),t.onDisconnect_=Nt(),_e(t.eventQueue_,k(),i)}function td(t,e,n){let i;E(e._path)===".info"?i=ds(t.infoSyncTree_,e,n):i=ds(t.serverSyncTree_,e,n),Wr(t.eventQueue_,e._path,i)}function nd(t,e,n){let i;E(e._path)===".info"?i=Nn(t.infoSyncTree_,e,n):i=Nn(t.serverSyncTree_,e,n),Wr(t.eventQueue_,e._path,i)}function id(t){t.persistentConnection_&&t.persistentConnection_.interrupt(Kh)}function pi(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),q(n,...e)}function sd(t,e,n,i,s,r){pi(t,"transaction on "+e);const o={path:e,update:n,onComplete:i,status:null,order:Bs(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=_i(t,e,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{di("transaction failed: Data returned ",l,o.path),o.status=0;const c=Ut(t.transactionQueueTree_,e),u=Te(c)||[];u.push(o),hi(c,u);let h;typeof l=="object"&&l!==null&&ne(l,".priority")?(h=ye(l,".priority"),g(zh(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(ni(t.serverSyncTree_,e)||C.EMPTY_NODE).getPriority().val();const d=ui(t),_=U(l,h),m=Lr(_,a,d);o.currentOutputSnapshotRaw=_,o.currentOutputSnapshotResolved=m,o.currentWriteId=Ur(t);const y=Rr(t.serverSyncTree_,e,m,o.currentWriteId,o.applyLocally);_e(t.eventQueue_,e,y),qt(t,t.transactionQueueTree_)}}function _i(t,e,n){return ni(t.serverSyncTree_,e,n)||C.EMPTY_NODE}function qt(t,e=t.transactionQueueTree_){if(e||Gt(t,e),Te(e)){const n=qr(t,e);g(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&rd(t,pt(e),n)}else Mr(e)&&Vt(e,n=>{qt(t,n)})}function rd(t,e,n){const i=n.map(c=>c.currentWriteId),s=_i(t,e,i);let r=s;const o=s.hash();for(let c=0;c<n.length;c++){const u=n[c];g(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=j(e,u.path);r=r.updateChild(h,u.currentOutputSnapshotRaw)}const a=r.val(!0),l=e;t.server_.put(l.toString(),a,c=>{pi(t,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){const h=[];for(let d=0;d<n.length;d++)n[d].status=2,u=u.concat(Re(t.serverSyncTree_,n[d].currentWriteId)),n[d].onComplete&&h.push(()=>n[d].onComplete(null,!0,n[d].currentOutputSnapshotResolved)),n[d].unwatcher();Gt(t,Ut(t.transactionQueueTree_,e)),qt(t,t.transactionQueueTree_),_e(t.eventQueue_,e,u);for(let d=0;d<h.length;d++)dt(h[d])}else{if(c==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{Q("transaction at "+l.toString()+" failed: "+c);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=c}gi(t,e)}},o)}function gi(t,e){const n=Vr(t,e),i=pt(n),s=qr(t,n);return od(t,s,i),i}function od(t,e,n){if(e.length===0)return;const i=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],c=j(n,l.path);let u=!1,h;if(g(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,h=l.abortReason,s=s.concat(Re(t.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=Yh)u=!0,h="maxretry",s=s.concat(Re(t.serverSyncTree_,l.currentWriteId,!0));else{const d=_i(t,l.path,o);l.currentInputSnapshot=d;const _=e[a].update(d.val());if(_!==void 0){di("transaction failed: Data returned ",_,l.path);let m=U(_);typeof _=="object"&&_!=null&&ne(_,".priority")||(m=m.updatePriority(d.getPriority()));const T=l.currentWriteId,f=ui(t),p=Lr(m,d,f);l.currentOutputSnapshotRaw=m,l.currentOutputSnapshotResolved=p,l.currentWriteId=Ur(t),o.splice(o.indexOf(T),1),s=s.concat(Rr(t.serverSyncTree_,l.path,p,l.currentWriteId,l.applyLocally)),s=s.concat(Re(t.serverSyncTree_,T,!0))}else u=!0,h="nodata",s=s.concat(Re(t.serverSyncTree_,l.currentWriteId,!0))}_e(t.eventQueue_,n,s),s=[],u&&(e[a].status=2,(function(d){setTimeout(d,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(h),!1,null))))}Gt(t,t.transactionQueueTree_);for(let a=0;a<i.length;a++)dt(i[a]);qt(t,t.transactionQueueTree_)}function Vr(t,e){let n,i=t.transactionQueueTree_;for(n=E(e);n!==null&&Te(i)===void 0;)i=Ut(i,n),e=x(e),n=E(e);return i}function qr(t,e){const n=[];return Gr(t,e,n),n.sort((i,s)=>i.order-s.order),n}function Gr(t,e,n){const i=Te(e);if(i)for(let s=0;s<i.length;s++)n.push(i[s]);Vt(e,s=>{Gr(t,s,n)})}function Gt(t,e){const n=Te(e);if(n){let i=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[i]=n[s],i++);n.length=i,hi(e,n.length>0?n:void 0)}Vt(e,i=>{Gt(t,i)})}function ad(t,e){const n=pt(Vr(t,e)),i=Ut(t.transactionQueueTree_,e);return Fh(i,s=>{ln(t,s)}),ln(t,i),Or(i,s=>{ln(t,s)}),n}function ln(t,e){const n=Te(e);if(n){const i=[];let s=[],r=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(g(r===o-1,"All SENT items should be at beginning of queue."),r=o,n[o].status=3,n[o].abortReason="set"):(g(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(Re(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&i.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?hi(e,void 0):n.length=r+1,_e(t.eventQueue_,pt(e),s);for(let o=0;o<i.length;o++)dt(i[o])}}function ld(t){let e="";const n=t.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let s=n[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function cd(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const i=n.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Q(`Invalid query segment '${n}' in query '${t}'`)}return e}const _s=function(t,e){const n=hd(t),i=n.namespace;n.domain==="firebase.com"&&le(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&n.domain!=="localhost"&&le("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||bl();const s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new Xs(n.host,n.secure,i,s,e,"",i!==n.subdomain),path:new N(n.pathString)}},hd=function(t){let e="",n="",i="",s="",r="",o=!0,a="https",l=443;if(typeof t=="string"){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let u=t.indexOf("/");u===-1&&(u=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(u,h)),u<h&&(s=ld(t.substring(u,h)));const d=cd(t.substring(Math.min(t.length,h)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;const _=e.slice(0,c);if(_.toLowerCase()==="localhost")n="localhost";else if(_.split(".").length<=2)n=_;else{const m=e.indexOf(".");i=e.substring(0,m).toLowerCase(),n=e.substring(m+1),r=i}"ns"in d&&(r=d.ns)}return{host:e,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};class dd{constructor(e,n,i,s){this.eventType=e,this.eventRegistration=n,this.snapshot=i,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+W(this.snapshot.exportVal())}}class ud{constructor(e,n,i){this.eventRegistration=e,this.error=n,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class fd{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return g(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class mi{constructor(e,n,i,s){this._repo=e,this._path=n,this._queryParams=i,this._orderByCalled=s}get key(){return S(this._path)?null:or(this._path)}get ref(){return new ce(this._repo,this._path)}get _queryIdentifier(){const e=Zi(this._queryParams),n=Hn(e);return n==="{}"?"default":n}get _queryObject(){return Zi(this._queryParams)}isEqual(e){if(e=lt(e),!(e instanceof mi))return!1;const n=this._repo===e._repo,i=Vn(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+sc(this._path)}}class ce extends mi{constructor(e,n){super(e,n,new Kn,!1)}get parent(){const e=lr(this._path);return e===null?null:new ce(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class ot{constructor(e,n,i){this._node=e,this.ref=n,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new N(e),i=Rn(this.ref,e);return new ot(this._node.getChild(n),i,L)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new ot(s,Rn(this.ref,i),L)))}hasChild(e){const n=new N(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function jr(t,e){return t=lt(t),t._checkNotDeleted("ref"),e!==void 0?Rn(t._root,e):t._root}function Rn(t,e){return t=lt(t),E(t._path)===null?Uh("child","path",e):$r("child","path",e),new ce(t._repo,F(t._path,e))}class vi{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const i=n._queryParams.getIndex();return new dd("value",this,new ot(e.snapshotNode,new ce(n._repo,n._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new ud(this,e,n):null}matches(e){return e instanceof vi?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function pd(t,e,n,i,s){const r=new fd(n,void 0),o=new vi(r);return td(t._repo,t,o),()=>nd(t._repo,t,o)}function Kr(t,e,n,i){return pd(t,"value",e)}ph(ce);Ch(ce);const _d="FIREBASE_DATABASE_EMULATOR_HOST",xn={};let gd=!1;function md(t,e,n,i){const s=e.lastIndexOf(":"),r=e.substring(0,s),o=Fn(r);t.repoInfo_=new Xs(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),i&&(t.authTokenProvider_=i)}function vd(t,e,n,i,s){let r=i||t.options.databaseURL;r===void 0&&(t.options.projectId||le("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),q("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=_s(r,s),a=o.repoInfo,l;typeof process<"u"&&Mi&&(l=Mi[_d]),l?(r=`http://${l}?ns=${a.namespace}`,o=_s(r,s),a=o.repoInfo):o.repoInfo.secure;const c=new Dl(t.name,t.options,e);qh("Invalid Firebase Database URL",o),S(o.path)||le("Database URL must point to the root of a Firebase Database (not including a child path).");const u=Cd(a,t,c,new xl(t,n));return new bd(u,t)}function yd(t,e){const n=xn[e];(!n||n[t.key]!==t)&&le(`Database ${e}(${t.repoInfo_}) has already been deleted.`),id(t),delete n[t.key]}function Cd(t,e,n,i){let s=xn[e.name];s||(s={},xn[e.name]=s);let r=s[t.toURLString()];return r&&le("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Qh(t,gd,n,i),s[t.toURLString()]=r,r}class bd{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Xh(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ce(this._repo,k())),this._rootInternal}_delete(){return this._rootInternal!==null&&(yd(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&le("Cannot call "+e+" on a deleted database.")}}function Ed(t=il(),e){const n=Ja(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const i=Fo("database");i&&Id(n,...i)}return n}function Id(t,e,n,i={}){t=lt(t),t._checkNotDeleted("useEmulator");const s=`${e}:${n}`,r=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&bt(i,r.repoInfo_.emulatorOptions))return;le("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&le('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new vt(vt.OWNER);else if(i.mockUserToken){const a=typeof i.mockUserToken=="string"?i.mockUserToken:$o(i.mockUserToken,t.app.options.projectId);o=new vt(a)}Fn(e)&&(Bo(e),zo("Database",!0)),md(r,s,i,o)}function Sd(t){gl(nl),It(new Je("database",(e,{instanceIdentifier:n})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return vd(i,s,r,n)},"PUBLIC").setMultipleInstances(!0)),xe(Oi,Fi,t),xe(Oi,Fi,"esm2020")}class Td{constructor(e,n){this.committed=e,this.snapshot=n}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function wd(t,e,n){if(t=lt(t),Vh("Reference.transaction",t._path),t.key===".length"||t.key===".keys")throw"Reference.transaction failed: "+t.key+" is a read-only object.";const i=!0,s=new Ot,r=(a,l,c)=>{let u=null;a?s.reject(a):(u=new ot(c,new ce(t._repo,t._path),L),s.resolve(new Td(l,u)))},o=Kr(t,()=>{});return sd(t._repo,t._path,e,r,o,i),s.promise}oe.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};oe.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};Sd();const kd={apiKey:"AIzaSyBIqN2D_dZNb2p1xsFWYi96lfMm5UGaamE",authDomain:"sockenstudie-a3b70.firebaseapp.com",databaseURL:"https://sockenstudie-a3b70-default-rtdb.europe-west1.firebasedatabase.app",projectId:"sockenstudie-a3b70",storageBucket:"sockenstudie-a3b70.firebasestorage.app",messagingSenderId:"635872092825",appId:"1:635872092825:web:400af1119ad9c8cdcece08"},Nd=Ps(kd),Yr=Ed(Nd),Dn="sockenstudie_liked_image";function Pn(){return localStorage.getItem(Dn)}function Ln(){return!!Pn()}async function Ad(t,e=!1){if(Ln()&&!e||!Ln()&&e)return!1;const n=jr(Yr,"likes/"+t.replace(/\./g,"_"));try{return await wd(n,i=>{const s=i||0;return e?Math.max(0,s-1):s+1}),e?localStorage.removeItem(Dn):localStorage.setItem(Dn,t),!0}catch(i){return console.error("Like failed",i),!1}}function Qr(t){const e=jr(Yr,"likes");return Kr(e,n=>{t(n.val()||{})})}function gs(t,e){const n=document.getElementById(t);if(!n)return;if(!e||e.length===0){n.innerHTML='<div class="slideshow-empty">Keine Zeichnungen verfügbar</div>';return}const i=e.map(a=>{const l=typeof a=="string"?a:a.datei,c=typeof a=="string"?"Unbekannt":a.name||"Unbekannt",u=typeof a=="string"||!a.alter?"":`, ${a.alter}`,h=`${c}${u}`,d=l.replace(/\./g,"_");return`
    <div class="swiper-slide">
      <div class="polaroid-content">
        <img src="./drawings/${encodeURIComponent(l)}" alt="Teilnehmer Zeichnung" loading="lazy">
        <div class="polaroid-caption">${h}</div>
        <div class="polaroid-actions">
          <button class="btn-like" data-image="${l}" id="like-btn-${d}">
            <span class="like-icon">❤️</span> <span class="like-count" id="like-count-${d}">0</span>
          </button>
        </div>
      </div>
    </div>
  `}).join("");n.innerHTML=`
    <div class="swiper polaroid-swiper">
      <div class="swiper-wrapper">
        ${i}
      </div>
      <div class="swiper-pagination"></div>
    </div>
    <p class="swipe-hint">← wischen →</p>
  `;const s=document.getElementById("vote-overlay"),r=document.getElementById("btn-vote-ok");s&&r&&r.addEventListener("click",()=>{s.classList.add("hidden"),n.classList.remove("obscured")}),new oo(n.querySelector(".swiper"),{modules:[wo,bo,yo],effect:"cards",grabCursor:!0,pagination:{el:n.querySelector(".swiper-pagination"),type:"fraction"},keyboard:{enabled:!0}}),n.querySelectorAll(".btn-like").forEach(a=>{a.addEventListener("click",async()=>{const l=a.getAttribute("data-image"),c=Pn()===l;if(Ln()&&!c){alert("Du hast bereits für eine Socke abgestimmt! Du kannst deine Stimme aber wieder entfernen, indem du noch einmal auf deine aktuell gelikte Socke klickst.");return}a.disabled=!0,await Ad(l,c)||(a.disabled=!1)})}),Qr(a=>{const l=Pn(),c=n.querySelectorAll(".btn-like");Object.keys(a).forEach(u=>{const h=document.getElementById(`like-count-${u}`);h&&(h.textContent=a[u])}),c.forEach(u=>{const h=u.getAttribute("data-image"),d=h.replace(/\./g,"_");l?l===h?(u.disabled=!1,u.classList.add("liked")):(u.disabled=!0,u.classList.remove("liked")):(u.disabled=!1,u.classList.remove("liked"));const _=document.getElementById(`like-count-${d}`);_&&(_.textContent=a[d]||0)})})}const Rd=["Dyadische Überlappungsfaltung","Kompressionsbasierte Bündelung","Lineare Parallelfaltung","Unstrukturierte Ablage"];function cn(t,e){const n=document.getElementById(t);if(!n)return;if(n.innerHTML="",!e||e.length===0){n.innerHTML='<div class="text-list-empty">Keine Einträge vorhanden</div>';return}const i={};e.forEach(o=>{const a=o.faltStrategie!==null&&o.faltStrategie!==void 0?String(o.faltStrategie):"unknown";i[a]||(i[a]=[]),i[a].push(o)}),Rd.forEach((o,a)=>{const l=i[String(a)];if(!l||l.length===0)return;const c=document.createElement("div");c.className="faltstrategie-group",c.innerHTML=`
      <div class="faltstrategie-group-header">
        <span class="faltstrategie-group-badge">${a+1}</span>
        <span class="faltstrategie-group-name">${o}</span>
      </div>
      <div class="faltstrategie-group-cards"></div>
    `;const u=c.querySelector(".faltstrategie-group-cards");l.forEach(h=>u.appendChild(Xr(h.text,h.name,h.alter))),n.appendChild(c)});const s=n.querySelectorAll(".text-card"),r=new IntersectionObserver(o=>{o.forEach(a=>{a.isIntersecting&&(a.target.classList.add("visible"),r.unobserve(a.target))})},{threshold:.1});s.forEach(o=>r.observe(o))}function ms(t,e){const n=document.getElementById(t);if(!n)return;if(!e||e.length===0){n.innerHTML='<div class="text-list-empty">Keine Einträge vorhanden</div>';return}n.innerHTML="",e.forEach(r=>{const o=typeof r=="string"?r:r.text,a=typeof r=="string"?null:r.name,l=typeof r=="string"?null:r.alter,c=Xr(o,a,l);n.appendChild(c)});const i=n.querySelectorAll(".text-card"),s=new IntersectionObserver(r=>{r.forEach(o=>{o.isIntersecting&&(o.target.classList.add("visible"),s.unobserve(o.target))})},{threshold:.1});i.forEach(r=>s.observe(r))}function Xr(t,e,n){const i=document.createElement("div");i.className="text-card",i.setAttribute("role","article");const s=document.createElement("span");s.textContent=t;const r=s.innerHTML,o=e||"Unbekannt",a=n?`, ${n}`:"",l=`${o}${a}`;return i.innerHTML=`
    <div class="text-card-content">„${r}"</div>
    <div class="text-card-author">~ ${l}</div>
  `,i}function xd(t,e=5){const n=[...t].sort((s,r)=>s.pct-r.pct);let i=0;for(;i<n.length;){let s=i;for(;s<n.length-1&&n[s+1].pct-n[i].pct<e;)s++;for(let r=0;r<s-i+1;r++)n[i+r].yLevel=r;i=s+1}return n}function vs(t,e){const n=document.getElementById(t);if(!n)return;n.innerHTML="";const i=document.createElement("div");if(i.className="visualization-card",!(Array.isArray(e)&&e.length>0))i.innerHTML=`
      <div class="visualization-card-index">D3</div>
      <div class="visualization-title">Wie stark identifizieren Sie sich mit Ihrem präferierten Sockenpaar?</div>
      <div class="group-scale-wrapper">
        <div class="group-dots-container">
          <div class="likert-no-data">Daten werden noch erhoben</div>
        </div>
        <div class="group-scale-line"></div>
        <div class="likert-labels" aria-hidden="true">
          <span>gar nicht</span>
          <span>vollständig</span>
        </div>
      </div>
    `;else{const o=e.filter(h=>h.value!==null&&h.value!==void 0&&h.value!=="").map(h=>({pct:Math.min(100,Math.max(0,Number(h.value))),isPersonal:(h.zugehoerigkeit||"").toLowerCase()==="personal"})),a=xd(o),l=0,c=18,u=a.map(h=>`
      <div class="group-dot ${h.isPersonal?"personal":"patienten"}"
           style="left: ${h.pct.toFixed(1)}%; bottom: ${l+h.yLevel*c}px;"
           title="${h.isPersonal?"Therapeutisches Team":"Patient"}">
      </div>
    `).join("");i.innerHTML=`
      <div class="visualization-card-index">D3</div>
      <div class="visualization-title">Wie stark identifizieren Sie sich mit Ihrem präferierten Sockenpaar?</div>
      <div class="group-scale-wrapper">
        <div class="group-dots-container">
          ${u}
        </div>
        <div class="group-scale-line"></div>
        <div class="likert-labels" aria-hidden="true">
          <span>gar nicht</span>
          <span>vollständig</span>
        </div>
      </div>
      <div class="likert-legend" aria-hidden="true">
        <div class="likert-legend-item">
          <div class="group-dot-legend patienten"></div>
          <span>Patient</span>
        </div>
        <div class="likert-legend-item">
          <div class="group-dot-legend personal"></div>
          <span>Therapeutisches Team</span>
        </div>
      </div>
    `}n.appendChild(i);const r=new IntersectionObserver(o=>{o.forEach(a=>{a.isIntersecting&&(a.target.classList.add("visible"),r.unobserve(a.target))})},{threshold:.12});r.observe(i)}function Dd(t,e){const n=document.getElementById(t);if(!n)return;n.innerHTML=`
    <div class="podium-section">
      <h3>🏆 Die beliebtesten Sockenpaare 🏆</h3>
      <div class="podium-container" id="podium-ranks">
        <p class="podium-loading">Stimmen werden gezählt...</p>
      </div>
    </div>
  `;const i=document.getElementById("podium-ranks");Qr(s=>{const r=e.map(c=>{const u=typeof c=="string"?c:c.datei,h=u.replace(/\./g,"_"),d=typeof c=="string"?"Unbekannt":c.name||"Unbekannt",_=s[h]||0;return{filename:u,name:d,likes:_}});r.sort((c,u)=>u.likes-c.likes);const o=r.slice(0,3);if(o.reduce((c,u)=>c+u.likes,0)===0){i.innerHTML='<p class="podium-empty">Noch keine Stimmen abgegeben. Werde der Erste!</p>';return}const l=(c,u)=>c?`
        <div class="podium-place rank-${u}">
          <div class="podium-medal">${u===1?"🥇":u===2?"🥈":"🥉"}</div>
          <img src="./drawings/${encodeURIComponent(c.filename)}" alt="Platz ${u}" class="podium-img">
          <div class="podium-block"></div>
        </div>
      `:'<div class="podium-place empty"></div>';i.innerHTML=`
      ${l(o[1],2)}
      ${l(o[0],1)}
      ${l(o[2],3)}
    `})}const Pd=["start","teil-a","teil-b","teil-c","teil-d1","teil-d2","teil-d3","teil-e","danke"],hn={questions:po,scaleMin:0,scaleMax:2,scaleLabels:["Trifft nicht zu","neutral","Trifft zu"],prefix:"E4."};document.addEventListener("DOMContentLoaded",async()=>{new ao(Pd),document.body.classList.add("loading-data");try{const t=await ho(),e=t.rawRows;ke("teil-a-content",t.teilA),se("teil-b-content",t.teilB,Kt),se("teil-c-content",t.teilC,Yt),cn("faltstrategien-content",t.faltstrategieTexte),ms("abschiebsbriefe-content",t.abschiebsbriefe),gs("slideshow-container",t.zeichnungen),vs("teil-d3-content",t.teilD3),se("teil-e-single-content",t.teilE.singleChoice,Qt),ke("teil-e-likert-content",t.teilE.likert3,hn),Dd("podium-content",t.zeichnungen),mt("teil-a",e,n=>{ke("teil-a-content",n.teilA)}),mt("teil-b",e,n=>{se("teil-b-content",n.teilB,Kt)}),mt("teil-c",e,n=>{se("teil-c-content",n.teilC,Yt),cn("faltstrategien-content",n.faltstrategieTexte)}),mt("teil-e",e,n=>{se("teil-e-single-content",n.teilE.singleChoice,Qt),ke("teil-e-likert-content",n.teilE.likert3,hn)})}catch(t){console.error("Failed to load data:",t),ke("teil-a-content",[]),se("teil-b-content",[],Kt),se("teil-c-content",[],Yt),cn("faltstrategien-content",[]),ms("abschiebsbriefe-content",[]),gs("slideshow-container",[]),vs("teil-d3-content",[]),se("teil-e-single-content",[],Qt),ke("teil-e-likert-content",[],hn)}finally{document.body.classList.remove("loading-data")}});function mt(t,e,n){const i=document.getElementById(`page-${t}`);if(!i)return;const s=i.querySelectorAll(".filter-btn");s.forEach(r=>{r.addEventListener("click",()=>{s.forEach(a=>a.classList.remove("active")),r.classList.add("active");const o=uo(e,r.dataset.filter);n(o)})})}
